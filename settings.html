<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ› ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</title>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="auth.js"></script> 
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
/* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© */
body {
    font-family: 'Cairo', sans-serif;
    background-color: #0f172a;
    color: #f1f5f9;
    padding: 20px;
    min-height: 100vh;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
}

h2 {
    color: #34d399;
    margin-bottom: 25px;
}

/* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù†Ù…ÙˆØ°Ø¬ */
.form-section {
    background-color: #1e293b;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

.form-section h3 {
    color: #94a3b8;
    border-bottom: 2px solid #334155;
    padding-bottom: 10px;
    margin-bottom: 15px;
    font-size: 1.2rem;
}

/* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
.input-group {
    margin-bottom: 15px;
    text-align: right;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: 700;
    color: #cbd5e1;
}

input[type="number"],
input[type="text"] {
    width: calc(100% - 20px);
    padding: 10px;
    border: none;
    border-radius: 5px;
    background-color: #334155;
    color: #f1f5f9;
    font-size: 1rem;
    box-sizing: border-box;
}

/* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
.category-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 10px;
}

.category-item {
    padding: 10px;
    border-radius: 8px;
    background-color: #334155;
    cursor: pointer;
    text-align: center;
    transition: background-color 0.2s, transform 0.2s;
    font-size: 0.9rem;
    position: relative;
    border: 2px solid transparent;
}

.category-item:hover {
    background-color: #475569;
}

.category-item.selected {
    background-color: #6366f1;
    border-color: #a5b4fc;
    color: #ffffff;
    transform: translateY(-2px);
}

.category-pro-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background-color: #ffcc00;
    color: #1e293b;
    padding: 2px 6px;
    border-radius: 5px;
    font-size: 0.7rem;
    font-weight: 700;
}

/* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
button#saveSettingsBtn {
    width: 100%;
    padding: 12px;
    font-size: 1.1rem;
    font-weight: 700;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background-color: #34d399;
    color: #0f172a;
    transition: background-color 0.2s, transform 0.2s;
    margin-top: 10px;
}

button#saveSettingsBtn:hover {
    background-color: #10b981;
    transform: translateY(-1px);
}

.toggle-switch {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}

.switch input { 
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 34px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: #34d399;
}

input:checked + .slider:before {
  transform: translateX(26px);
}

/* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† */
#player-list-container {
    max-height: 200px;
    overflow-y: auto;
    padding-right: 10px;
    margin-top: 10px;
}

.player-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #334155;
}

.player-item span {
    flex-grow: 1;
    text-align: right;
}

.player-item button {
    background: none;
    border: none;
    color: #ff4f4f;
    cursor: pointer;
    font-size: 1rem;
    padding: 0 5px;
}

/* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Pro */
.pro-feature {
    padding: 10px;
    border: 1px dashed #ffcc00;
    border-radius: 5px;
    color: #ffcc00;
    margin-top: 10px;
    text-align: center;
    font-size: 0.9rem;
}

.pro-locked-item {
    opacity: 0.5;
    pointer-events: none;
}
</style>
</head>

<body onload="loadSettings()">

<div id="coin-display" style="position: absolute; top: 20px; left: 20px; font-size: 1.2rem; font-weight: 700; color: #ffd700;">
    <i class="fas fa-coins"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total-coins-value">0</span>
</div>

<a href="index.html" style="position: absolute; top: 20px; right: 20px; font-size: 24px; color: #94a3b8;" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
    <i class="fas fa-home"></i>
</a>

<h2>ğŸ› ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>

<div class="form-section">
    <h3><i class="fas fa-users"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 3)</h3>
    <div class="input-group">
        <label for="newPlayerName">Ø§Ø³Ù… Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯:</label>
        <div style="display: flex;">
            <input type="text" id="newPlayerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…">
            <button onclick="addPlayer()" style="margin: 0; margin-right: 10px; padding: 10px 15px; background-color: #6366f1;">
                <i class="fas fa-plus"></i>
            </button>
        </div>
    </div>
    <div id="player-list-container">
        <div id="player-list">
            </div>
    </div>
</div>

<div class="form-section">
    <h3><i class="fas fa-cogs"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯ÙˆØ± ÙˆØ§Ù„ÙˆÙ‚Øª</h3>

    <div class="input-group">
        <label for="impostorsCount">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­ØªØ§Ù„ÙŠÙ†:</label>
        <input type="number" id="impostorsCount" min="1" max="5" value="1">
    </div>

    <div class="toggle-switch">
        <span>Ø¯ÙˆØ± "Ø¨Ù„Ø§ ÙƒÙ„Ù…Ø©" (Pro)</span>
        <label class="switch">
            <input type="checkbox" id="noWordToggle">
            <span class="slider round"></span>
        </label>
    </div>
    <div id="noWordProLock" class="pro-feature" style="display: none;">ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ÙŠØªØ·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ Pro.</div>


    <div class="toggle-switch">
        <span>ÙƒÙ„Ù…Ø© Ù…Ø­ØªØ§Ù„ Ù…Ø®ØªÙ„ÙØ© (Pro)</span>
        <label class="switch">
            <input type="checkbox" id="multiWordToggle">
            <span class="slider round"></span>
        </label>
    </div>
     <div id="multiWordProLock" class="pro-feature" style="display: none;">ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ÙŠØªØ·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ Pro.</div>


    <div class="input-group">
        <label for="discussionTimer">Ù…Ø¤Ù‚Øª Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø© (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ):</label>
        <input type="number" id="discussionTimer" min="0" value="180">
        <div class="instruction-text" style="text-align: right; color: #94a3b8;">(0 ÙŠØ¹Ù†ÙŠ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¤Ù‚Øª)</div>
    </div>
</div>

<div class="form-section">
    <h3><i class="fas fa-book-open"></i> Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª</h3>
    <div id="categoriesContainer" class="category-grid">
        </div>
    <div id="category-error" class="pro-feature" style="color: #ff4f4f; border-color: #ff4f4f; display: none; margin-top: 15px;">
        Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø³Ù… ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.
    </div>
</div>

<button id="saveSettingsBtn" onclick="saveSettings()">
    Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© <i class="fas fa-arrow-left"></i>
</button>

<script>
// ** ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ·Ø§Ø¨Ù‚Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ role_assignment.html **
const wordCategories = {
    free: [
        { id: 'objects', name: "Ø£Ø´ÙŠØ§Ø¡", words: ["Ù‚Ù„Ù…", "ÙƒÙˆØ¨", "ÙƒØ±Ø³ÙŠ", "Ù…ÙØªØ§Ø­", "Ù‡Ø§ØªÙ", "ÙƒØªØ§Ø¨", "Ø³Ø§Ø¹Ø©", "Ù…ØµØ¨Ø§Ø­", "Ù…Ù„Ø¹Ù‚Ø©", "Ø­Ø°Ø§Ø¡", "Ø­Ù‚ÙŠØ¨Ø©", "Ø·Ø§ÙˆÙ„Ø©", "Ù…Ø±Ø¢Ø©", "Ø¯ÙØªØ±", "Ù…Ù…Ø­Ø§Ø©", "Ø¬Ø¯Ø§Ø±", "Ø´Ø¨Ø§Ùƒ", "Ø¨Ø§Ø¨", "Ø³Ø±ÙŠØ±", "ÙˆØ³Ø§Ø¯Ø©", "ØºØ·Ø§Ø¡", "Ø¬Ø±Ø³", "Ù…Ø¸Ù„Ø©", "Ù„ÙˆØ­Ø©", "Ù…Ø±ÙˆØ­Ø©", "ØµÙ†Ø¯ÙˆÙ‚", "ÙØ±Ø´Ø§Ø©", "Ù…Ø´Ø·", "Ù…Ù…Ø­Ø§Ø©", "Ù…Ø·Ø±Ù‚Ø©", "Ù…Ø³Ù…Ø§Ø±", "Ø®ÙŠØ·", "Ø¥Ø¨Ø±Ø©", "Ø®Ø²Ø§Ù†Ø©", "Ø­Ø¨Ù„", "Ø´Ø±ÙŠØ·", "ÙƒØ§Ù…ÙŠØ±Ø§", "Ù…Ø§ÙˆØ³", "Ø¨Ø·Ø§Ø±ÙŠØ©", "Ù„Ù…Ø¨Ø©", "Ù…Ù‚Øµ", "Ù…Ù†Ø´ÙØ©", "ØµÙ†Ø¨ÙˆØ±", "Ù‚ÙÙ„", "Ø³Ù„Ø©", "Ø³Ù„Ùƒ", "Ø´Ø§Ø­Ù†", "Ø£Ø±ÙŠÙƒØ©", "Ø±Ù"] },
        { id: 'nature', name: "Ø·Ø¨ÙŠØ¹Ø©", words: ["Ø´Ø¬Ø±Ø©", "Ù†Ù‡Ø±", "Ø¬Ø¨Ù„", "Ø³Ù…Ø§Ø¡", "Ø¨Ø­Ø±", "Ø´Ù…Ø³", "Ù‚Ù…Ø±", "Ù†Ø¬Ù…", "ØºÙŠÙ…Ø©", "Ù…Ø·Ø±", "Ø«Ù„Ø¬", "ØµØ®Ø±Ø©", "Ø±Ù…Ù„", "Ø¹Ø´Ø¨", "ÙˆØ±Ø¯Ø©", "Ù†Ø®Ù„Ø©", "Ø´Ø§Ø·Ø¦", "Ø¨Ø±ÙƒØ§Ù†", "ØµØ­Ø±Ø§Ø¡", "ÙˆØ§Ø¯ÙŠ", "ÙƒÙ‡Ù", "Ø¨Ø­ÙŠØ±Ø©", "Ø¶Ø¨Ø§Ø¨", "Ø±ÙŠØ§Ø­", "ØµÙ‚ÙŠØ¹", "ØªØ±Ø§Ø¨", "Ù†Ø¨ØªØ©", "Ø¨Ø°Ø±Ø©", "ÙØ¶Ø§Ø¡", "ÙƒÙˆÙƒØ¨", "Ø´Ù‡Ø§Ø¨", "Ø£ÙÙ‚", "Ø¬Ø³Ø±", "Ù…Ø²Ø±Ø¹Ø©", "Ø¹Ø§ØµÙØ©", "Ù†Ø³ÙŠÙ…", "Ø¸Ù„", "Ø¶ÙˆØ¡", "Ù…Ø­ÙŠØ·", "Ø¬Ø²ÙŠØ±Ø©", "Ø´Ù„Ø§Ù„", "Ù†Ø¨Ø¹", "Ø¬Ø°Ø¹", "ÙˆØ±Ù‚Ø©", "ØºØ§Ø¨Ø©", "Ø£Ø²Ù‡Ø§Ø±", "Ø³Ø­Ø§Ø¨Ø©", "Ø¨Ø¦Ø±"] },
        { id: 'jobs', name: "ÙˆØ¸Ø§Ø¦Ù", words: ["Ø·Ø¨ÙŠØ¨", "Ù…Ø¹Ù„Ù…", "Ù…Ù‡Ù†Ø¯Ø³", "Ø´Ø±Ø·ÙŠ", "Ø®Ø¨Ø§Ø²", "Ù…Ø²Ø§Ø±Ø¹", "Ù†Ø¬Ø§Ø±", "Ø·Ø¨Ø§Ø®", "Ø±Ø³Ø§Ù…", "Ù…Ø°ÙŠØ¹", "Ù‚Ø§Ø¶ÙŠ", "ÙƒØ§ØªØ¨", "Ø¬Ù†Ø¯ÙŠ", "Ø¨Ø­Ø§Ø±", "Ø·ÙŠØ§Ø±", "ØµÙŠØ¯Ù„ÙŠ", "Ù…Ù…Ø±Ø¶", "Ù…ØµÙˆØ±", "Ù…ÙˆØ³ÙŠÙ‚ÙŠ", "Ø®ÙŠØ§Ø·", "Ø³Ø§Ø¦Ù‚", "Ù…Ø­Ø§Ù…ÙŠ", "Ø¨Ø§Ø¦Ø¹", "Ù…ØªØ±Ø¬Ù…", "Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ", "Ø¨Ù†Ø§Ø¡", "ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ", "Ø­Ø¯Ø§Ø¯", "Ø¬Ø²Ø§Ø±", "Ø´Ø§Ø¹Ø±", "ØµØ­ÙÙŠ", "Ù†Ø§Ù‚Ø¯", "Ø­Ø§Ø±Ø³", "Ø±ÙŠØ§Ø¶ÙŠ", "Ø¹Ø§Ù…Ù„", "Ø¥Ø·ÙØ§Ø¦ÙŠ", "Ù…Ø±Ø´Ø¯", "Ø®Ø§Ø¯Ù…", "Ù…Ø­Ø§Ø³Ø¨", "Ù…Ø¯Ø±Ø¨", "ÙÙ†Ø§Ù†", "ØµØ§Ù†Ø¹", "Ù…ÙˆØ²Ø¹", "Ù…ÙØªØ´", "Ø¹Ø§Ù„Ù…", "ÙÙ„ÙƒÙŠ", "Ù…Ø±Ø§Ø³Ù„"] }
    ],
    pro: [
        { id: 'foods', name: "Ø£Ø·Ø¹Ù…Ø©", words: ["ØªÙØ§Ø­", "Ù…ÙˆØ²", "Ø¨Ø±ØªÙ‚Ø§Ù„", "Ù…Ø§Ø¡", "Ù‚Ù‡ÙˆØ©", "Ø´Ø§ÙŠ", "Ø®Ø¨Ø²", "Ø£Ø±Ø²", "Ù„Ø­Ù…", "Ø¯Ø¬Ø§Ø¬", "Ø³Ù…Ùƒ", "Ø¹ØµÙŠØ±", "Ø­Ù„ÙŠØ¨", "Ø¬Ø¨Ù†", "Ø¨ÙŠØ¶", "Ø³ÙƒØ±", "Ù…Ù„Ø­", "Ø²ÙŠØª", "Ø²Ø¨Ø¯Ø©", "Ø¹Ø³Ù„", "Ø¨Ø·Ø§Ø·Ø§", "Ø·Ù…Ø§Ø·Ù…", "Ø¨ØµÙ„", "Ø«ÙˆÙ…", "Ø®Ø³", "Ø¬Ø²Ø±", "ÙƒØ¹ÙƒØ©", "Ù…Ø«Ù„Ø¬Ø§Øª", "Ù…ÙƒØ±ÙˆÙ†Ø©", "Ø¨ÙŠØªØ²Ø§", "Ø³Ù„Ø·Ø©", "Ø­Ø³Ø§Ø¡", "ØªÙˆØ§Ø¨Ù„", "Ù…Ø´Ø±ÙˆØ¨", "Ø¹Ù†Ø¨", "Ù…Ø§Ù†Ø¬Ùˆ", "ÙÙ„ÙÙ„", "Ù„ÙŠÙ…ÙˆÙ†", "Ø¨Ø³ÙƒÙˆÙŠØª", "ÙÙˆÙ„", "Ø¹Ø¯Ø³", "ÙØ±Ø§ÙˆÙ„Ø©", "Ø²ÙŠØªÙˆÙ†", "Ù…Ø±Ø¨Ù‰", "Ø³ÙƒØ±", "Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©", "ÙØ·Ø±", "Ø¹Ù„ÙƒØ©"] },
        { id: 'animals', name: "Ø­ÙŠÙˆØ§Ù†Ø§Øª", words: ["ÙƒÙ„Ø¨", "Ù‚Ø·Ø©", "Ø£Ø³Ø¯", "Ù†Ù…Ø±", "ÙÙŠÙ„", "Ø²Ø±Ø§ÙØ©", "Ù‚Ø±Ø¯", "Ø­ØµØ§Ù†", "Ø¬Ù…Ù„", "Ø¶ÙØ¯Ø¹", "Ø«Ø¹Ù„Ø¨", "Ø°Ø¦Ø¨", "Ø¯Ø¨", "Ø£Ø±Ù†Ø¨", "Ø³Ù†Ø¬Ø§Ø¨", "Ø·Ø§Ø¦Ø±", "Ø­Ù…Ø§Ù…Ø©", "ØµÙ‚Ø±", "Ø¨ÙˆÙ…Ø©", "Ù†Ø³Ø±", "Ø¨Ø·Ø©", "Ø¯ÙŠÙƒ", "Ø¯Ø¬Ø§Ø¬Ø©", "Ø¨Ù‚Ø±Ø©", "ØºØ²Ø§Ù„", "ØªÙ…Ø³Ø§Ø­", "Ø«Ø¹Ø¨Ø§Ù†", "Ø³Ù…ÙƒØ©", "Ù‚Ø±Ø´", "Ø¯ÙˆÙ„ÙÙŠÙ†", "Ø­ÙˆØª", "Ù†Ø­Ù„Ø©", "Ù†Ù…Ù„Ø©", "Ø¹Ù†ÙƒØ¨ÙˆØª", "ÙØ±Ø§Ø´Ø©", "ÙŠØ±Ø¨ÙˆØ¹", "Ø³Ù„Ø­ÙØ§Ø©", "Ø®Ø±ÙˆÙ", "Ù…Ø§Ø¹Ø²", "ÙØ£Ø±", "Ø¨Ø¨ØºØ§Ø¡", "ÙƒÙ†ØºØ±", "Ø¨Ø·Ø±ÙŠÙ‚", "Ø¶Ø¨Ø¹", "Ù†ÙˆØ±Ø³", "Ø¹Ù‚Ø§Ø¨", "Ø³Ø¹Ø¯Ø§Ù†"] },
        { id: 'clothes', name: "Ù…Ù„Ø§Ø¨Ø³", words: ["Ù‚Ù…ÙŠØµ", "Ø¨Ù†Ø·Ø§Ù„", "ÙØ³ØªØ§Ù†", "ØªÙ†ÙˆØ±Ø©", "Ù…Ø¹Ø·Ù", "Ø³ØªØ±Ø©", "Ø­Ø¬Ø§Ø¨", "ÙˆØ´Ø§Ø­", "Ù‚Ø¨Ø¹Ø©", "Ø¬ÙˆØ±Ø¨", "Ù‚ÙØ§Ø²", "Ø­Ø°Ø§Ø¡", "ØµÙ†Ø¯Ù„", "Ø­Ù‚ÙŠØ¨Ø©", "Ù†Ø¸Ø§Ø±Ø©", "Ø­Ø²Ø§Ù…", "Ø³Ø§Ø¹Ø© ÙŠØ¯", "Ø®Ø§ØªÙ…", "Ù‚Ù„Ø§Ø¯Ø©", "Ø³ÙˆØ§Ø±", "Ø¬ÙŠØ¨", "Ø²Ø±", "Ø³Ø­Ø§Ø¨", "Ù‚Ù…Ø§Ø´", "Ø­Ø±ÙŠØ±", "Ø¬Ù„Ø¯", "Ù‚Ø·Ù†", "ØµÙˆÙ", "Ø¹Ø¨Ø§Ø¡Ø©", "Ø¨ÙŠØ¬Ø§Ù…Ø©", "Ø±Ø¨Ø·Ø© Ø¹Ù†Ù‚", "Ù…Ø±ÙŠÙˆÙ„", "ÙƒØ¨Ùƒ", "ÙØ±Ùˆ", "Ø´Ø§Ù„", "ØµØ¯Ø±ÙŠØ©", "Ù…Ù†Ø´ÙØ©", "Ù…Ù†Ø§Ù…Ø©", "Ù‚Ø¨Ø¹Ø© Ø´Ù…Ø³", "Ù…Ø´Ø¯", "Ø²ÙŠ", "Ø¨Ø§Ø±ÙˆÙƒØ©", "Ø¨ÙˆØª", "Ø¬ÙˆØ§Ø±Ø¨", "Ù„Ø¨Ø§Ø³", "Ø±Ø¯Ø§Ø¡", "Ù…Ø¦Ø²Ø±", "Ø³Ø±ÙˆØ§Ù„"] },
        { id: 'places', name: "Ø£Ù…Ø§ÙƒÙ†", words: ["Ù…Ø¯Ø±Ø³Ø©", "Ù…Ø³ØªØ´ÙÙ‰", "Ù…Ù†Ø²Ù„", "Ù…Ø³Ø¬Ø¯", "ÙƒÙ†ÙŠØ³Ø©", "Ø³ÙˆÙ‚", "Ù…ÙƒØªØ¨Ø©", "Ù…Ø·Ø§Ø±", "Ù…Ø­Ø·Ø©", "Ø­Ø¯ÙŠÙ‚Ø©", "Ù…ØªØ­Ù", "Ù…ØµÙ†Ø¹", "Ù…Ù‚Ù‡Ù‰", "Ù…Ø·Ø¹Ù…", "ÙÙ†Ø¯Ù‚", "Ù…Ø¨Ù†Ù‰", "Ø¬Ø³Ø±", "Ø·Ø±ÙŠÙ‚", "Ø´Ø§Ø±Ø¹", "Ø³Ø§Ø­Ø©", "Ù‚ØµØ±", "Ù‚Ù„Ø¹Ø©", "Ø¨Ø±Ø¬", "Ø¨ÙˆØ§Ø¨Ø©", "Ø¨Ø¦Ø±", "Ù…Ù„Ø¹Ø¨", "Ù†Ø§Ø¯ÙŠ", "Ø¬Ø§Ù…Ø¹Ø©", "ÙˆØ²Ø§Ø±Ø©", "Ø³ÙØ§Ø±Ø©", "ÙƒØ±Ø§Ø¬", "Ù†ÙÙ‚", "Ù…Ù…Ø±", "Ù‚Ø¨Ùˆ", "Ø³Ø·Ø­", "Ø´Ø±ÙØ©", "Ù…Ø®Ø²Ù†", "Ù…ÙˆÙ‚Ù", "ØºØ±ÙØ©", "Ù‚Ø§Ø¹Ø©", "Ø¨Ù‡Ùˆ", "Ù…Ø³ØªÙˆØ¯Ø¹", "Ù…Ø¬Ù„Ø³", "Ø®ÙŠÙ…Ø©", "Ù…Ø®Ø¨Ø²", "Ù…ØºØ³Ù„Ø©", "Ø¯ÙƒØ§Ù†"] },
        { id: 'activities', name: "Ø£Ù†Ø´Ø·Ø©", words: ["Ø¬Ø±ÙŠ", "Ø³Ø¨Ø§Ø­Ø©", "Ù‚Ø±Ø§Ø¡Ø©", "ÙƒØªØ§Ø¨Ø©", "Ø±Ø³Ù…", "ØºÙ†Ø§Ø¡", "Ø±Ù‚Øµ", "Ù„Ø¹Ø¨", "Ù†ÙˆÙ…", "Ø£ÙƒÙ„", "Ø´Ø±Ø¨", "Ø¶Ø­Ùƒ", "Ø¨ÙƒØ§Ø¡", "ØµØ±Ø§Ø®", "Ù…Ø´Ø§Ù‡Ø¯Ø©", "Ø§Ø³ØªÙ…Ø§Ø¹", "Ø­Ø¯ÙŠØ«", "Ø³ÙØ±", "ØµÙŠØ¯", "Ø·Ø¨Ø®", "ØªÙ†Ø¸ÙŠÙ", "Ø¹Ù…Ù„", "Ø¯Ø±Ø§Ø³Ø©", "Ù‚ÙŠØ§Ø¯Ø©", "Ø¨Ù†Ø§Ø¡", "Ù‡Ø¯Ù…", "Ø²Ø±Ø¹", "Ø­ØµØ§Ø¯", "Ø¥ØµÙ„Ø§Ø­", "ÙƒØ³Ø±", "ÙØªØ­", "Ø¥ØºÙ„Ø§Ù‚", "Ù‚ÙØ²", "ØµØ¹ÙˆØ¯", "Ù‡Ø¨ÙˆØ·", "Ø§Ù†ØªØ¸Ø§Ø±", "ØªÙÙƒÙŠØ±", "Ø­Ù„Ù…", "Ø¨Ù‚Ø§Ø¡", "ØªØ£Ù…Ù„", "ØªØ¬ÙˆÙ„", "Ø§Ø³ØªØ±Ø§Ø­Ø©", "Ø§Ø¬ØªÙ…Ø§Ø¹", "Ø¥Ø´Ø§Ø±Ø©", "Ø¥Ø±Ø³Ø§Ù„", "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„", "Ø³Ø¤Ø§Ù„"] },
        { id: 'adjectives', name: "ØµÙØ§Øª", words: ["Ø³Ø±ÙŠØ¹", "Ø¨Ø·ÙŠØ¡", "ÙƒØ¨ÙŠØ±", "ØµØºÙŠØ±", "Ø·ÙˆÙŠÙ„", "Ù‚ØµÙŠØ±", "Ø¬Ù…ÙŠÙ„", "Ù‚Ø¨ÙŠØ­", "Ø³Ø¹ÙŠØ¯", "Ø­Ø²ÙŠÙ†", "ØºØ§Ø¶Ø¨", "Ù‡Ø§Ø¯Ø¦", "ØµØ§Ø®Ø¨", "Ù†Ø¸ÙŠÙ", "Ù…ØªØ³Ø®", "Ù‚ÙˆÙŠ", "Ø¶Ø¹ÙŠÙ", "Ø¨Ø§Ø±Ø¯", "Ø­Ø§Ø±", "Ù…Ø´Ø±Ù‚", "Ù…Ø¸Ù„Ù…", "Ø¬Ø¯ÙŠØ¯", "Ù‚Ø¯ÙŠÙ…", "ØµØ¹Ø¨", "Ø³Ù‡Ù„", "Ø®ÙÙŠÙ", "Ø«Ù‚ÙŠÙ„", "Ø¬Ø§Ø¦Ø¹", "Ø¹Ø·Ø´Ø§Ù†", "Ù…Ø±ÙŠØ¶", "Ø³Ù„ÙŠÙ…", "Ø¨Ø¹ÙŠØ¯", "Ù‚Ø±ÙŠØ¨", "Ø­Ù‚ÙŠÙ‚ÙŠ", "ÙˆÙ‡Ù…ÙŠ", "Ø´Ø¬Ø§Ø¹", "Ø¬Ø¨Ø§Ù†", "Ù…Ø¶Ø­Ùƒ", "Ø¬Ø¯ÙŠ", "Ù…Ø£Ù„ÙˆÙ", "ØºØ±ÙŠØ¨", "Ø­ÙƒÙŠÙ…", "Ø£Ø­Ù…Ù‚", "Ù†Ø§Ø¬Ø­", "ÙØ§Ø´Ù„"] }
    ]
};

// Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ù…Ù† loadUserData
let currentPlayers = [];
let currentSettings = {};

const totalCoinsValue = document.getElementById("total-coins-value");
const categoriesContainer = document.getElementById("categoriesContainer");
const noWordToggle = document.getElementById('noWordToggle');
const multiWordToggle = document.getElementById('multiWordToggle');
const impostorsCount = document.getElementById('impostorsCount');
const discussionTimer = document.getElementById('discussionTimer');
const noWordProLock = document.getElementById('noWordProLock');
const multiWordProLock = document.getElementById('multiWordProLock');

/**
 * @function loadSettings
 * @description ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØ§Ù„ÙƒÙˆÙŠÙ†Ø² Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.
 */
async function loadSettings() {
    firebase.auth().onAuthStateChanged(async (user) => {
        if (!user) {
            alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
            window.location.href = "auth.html";
            return;
        }

        const data = await loadUserData(); // Ù…Ù† auth.js
        const isUserPro = window.isPro(); // Ù…Ù† auth.js

        if (data) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
            currentPlayers = data.players || [];
            currentSettings = data.settings || {};
            
            // Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²
            totalCoinsValue.innerText = data.totalCoins || 0;

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            impostorsCount.value = currentSettings.impostors || 1;
            discussionTimer.value = currentSettings.discussionTimer || 180;
            noWordToggle.checked = currentSettings.noWordRole || false;
            multiWordToggle.checked = currentSettings.multiWordMode || false;
        }
        
        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        renderPlayers();
        // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        renderCategories(isUserPro, currentSettings.selectedCategories || []);
        // ØªØ·Ø¨ÙŠÙ‚ Ù‚ÙŠÙˆØ¯ Pro
        applyProRestrictions(isUserPro);
    });
}

/**
 * @function renderCategories
 * @description Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Pro.
 */
function renderCategories(isPro, selectedCategories) {
    categoriesContainer.innerHTML = '';
    const allCategories = wordCategories.free.map(c => ({...c, isPro: false}))
        .concat(wordCategories.pro.map(c => ({...c, isPro: true})));

    allCategories.forEach(category => {
        const item = document.createElement('div');
        item.className = 'category-item';
        item.innerText = category.name;
        item.setAttribute('data-id', category.id);

        if (selectedCategories.includes(category.id)) {
            item.classList.add('selected');
        }

        if (category.isPro) {
            const badge = document.createElement('span');
            badge.className = 'category-pro-badge';
            badge.innerText = 'Pro';
            item.appendChild(badge);
            
            // Ù‚ÙÙ„ Ø§Ù„Ù‚Ø³Ù… Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Pro
            if (!isPro) {
                item.classList.add('pro-locked-item');
                item.setAttribute('title', 'ÙŠØªØ·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ Pro');
            }
        }

        item.onclick = function() {
            // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ¯ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø¬Ø§Ù†ÙŠ Ø£Ùˆ Pro
            if (!category.isPro || isPro) {
                item.classList.toggle('selected');
                document.getElementById('category-error').style.display = 'none';
            } else {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§Ùƒ Pro Ù„Ø§Ø®ØªÙŠØ§Ø± Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù….');
            }
        };

        categoriesContainer.appendChild(item);
    });
}

/**
 * @function applyProRestrictions
 * @description ØªØ·Ø¨ÙŠÙ‚ Ù‚ÙŠÙˆØ¯ Pro Ø¹Ù„Ù‰ Ù…ÙŠØ²Ø§Øª Ø§Ù„ØªØ¨Ø¯ÙŠÙ„.
 */
function applyProRestrictions(isPro) {
    if (!isPro) {
        if (!noWordToggle.checked) {
             noWordToggle.disabled = true;
             noWordProLock.style.display = 'block';
        }
        if (!multiWordToggle.checked) {
             multiWordToggle.disabled = true;
             multiWordProLock.style.display = 'block';
        }
    } else {
        noWordToggle.disabled = false;
        noWordProLock.style.display = 'none';
        multiWordToggle.disabled = false;
        multiWordProLock.style.display = 'none';
    }
}


/**
 * @function addPlayer
 * @description Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.
 */
function addPlayer() {
    const nameInput = document.getElementById('newPlayerName');
    const name = nameInput.value.trim();

    if (name && !currentPlayers.includes(name)) {
        currentPlayers.push(name);
        nameInput.value = ''; 
        renderPlayers();
    } else if (currentPlayers.includes(name)) {
        alert('Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„.');
    }
}

/**
 * @function removePlayer
 * @description Ø¥Ø²Ø§Ù„Ø© Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.
 */
function removePlayer(nameToRemove) {
    currentPlayers = currentPlayers.filter(name => name !== nameToRemove);
    renderPlayers();
}

/**
 * @function renderPlayers
 * @description Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.
 */
function renderPlayers() {
    const list = document.getElementById('player-list');
    list.innerHTML = '';

    if (currentPlayers.length === 0) {
        list.innerHTML = '<div style="color: #94a3b8; text-align: center; padding: 10px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙˆÙ†. Ø£Ø¶Ù Ø£Ø³Ù…Ø§Ø¡ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</div>';
    } else {
        currentPlayers.forEach(name => {
            const item = document.createElement('div');
            item.className = 'player-item';
            
            const nameSpan = document.createElement('span');
            nameSpan.innerText = name;

            const removeBtn = document.createElement('button');
            removeBtn.innerHTML = '<i class="fas fa-times"></i>';
            removeBtn.onclick = () => removePlayer(name);

            item.appendChild(nameSpan);
            item.appendChild(removeBtn);
            list.appendChild(item);
        });
    }
}

/**
 * @function saveSettings
 * @description Ø¬Ù…Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ­ÙØ¸Ù‡Ø§ ÙÙŠ Firebase Ø«Ù… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ø¹Ø¨Ø©.
 */
async function saveSettings() {
    // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù…
    if (currentPlayers.length < 3) {
        alert("ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© 3 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©.");
        return;
    }

    const selectedCategoryElements = document.querySelectorAll('.category-item.selected');
    const selectedCategories = Array.from(selectedCategoryElements).map(el => el.getAttribute('data-id'));

    if (selectedCategories.length === 0) {
        document.getElementById('category-error').style.display = 'block';
        return;
    }
    document.getElementById('category-error').style.display = 'none';

    // 2. Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    const newSettings = {
        impostors: Math.min(Math.max(parseInt(impostorsCount.value) || 1, 1), 5), // Ø¨ÙŠÙ† 1 Ùˆ 5
        discussionTimer: Math.max(parseInt(discussionTimer.value) || 180, 0), // >= 0
        noWordRole: noWordToggle.checked && window.isPro(), // ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡Ø§ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Pro
        multiWordMode: multiWordToggle.checked && window.isPro(), // ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡Ø§ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Pro
        selectedCategories: selectedCategories
    };

    // 3. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… saveUserData Ù…Ù† auth.js
    const saveSuccessful = await saveUserData(
        window.currentUserData.totalCoins || 0,
        window.currentUserData.proExpiryTime || 0,
        currentPlayers,
        newSettings
    );

    if (saveSuccessful) {
        alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­. Ø­Ø¸Ø§Ù‹ Ù…ÙˆÙÙ‚Ø§Ù‹!");
        window.location.href = "role_assignment.html"; 
    } else {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.");
    }
}
</script>

</body>
</html>

