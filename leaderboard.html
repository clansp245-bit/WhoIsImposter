<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</title>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="auth.js"></script> 

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <style>
        :root {
            --primary: #6366f1;
            --accent: #34d399;
            --glass-bg: rgba(30, 41, 59, 0.6);
            --glass-border: rgba(255, 255, 255, 0.1);
            --gold: #ffd700;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: #0a0f1e;
            background-image: radial-gradient(circle at top right, #1e1b4b, transparent);
            color: #f1f5f9;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h2 { font-weight: 900; font-size: 2rem; color: var(--accent); margin-bottom: 30px; text-shadow: 0 0 15px rgba(52, 211, 153, 0.3); }

        .leaderboard-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            width: 100%;
            max-width: 1100px;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ±Øª Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ */
        .leaderboard-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            padding: 25px;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        h3 { text-align: center; color: var(--gold); margin-bottom: 20px; font-size: 1.3rem; border-bottom: 1px solid var(--glass-border); padding-bottom: 10px; }

        .player-item {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.03);
            margin-bottom: 10px;
            padding: 12px 15px;
            border-radius: 15px;
            transition: 0.3s;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .player-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: scale(1.02);
            border-color: var(--primary);
        }

        .rank { width: 35px; font-weight: 900; font-size: 1.2rem; color: var(--accent); }

        /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ */
        .player-item:nth-child(2) .rank { color: #ffd700; } /* Ø°Ù‡Ø¨ÙŠ */
        .player-item:nth-child(3) .rank { color: #c0c0c0; } /* ÙØ¶ÙŠ */
        .player-item:nth-child(4) .rank { color: #cd7f32; } /* Ø¨Ø±ÙˆÙ†Ø²ÙŠ */

        .info { flex-grow: 1; margin-right: 10px; }
        .name { display: block; font-weight: 700; color: #fff; }
        .public-uid { font-size: 0.75rem; color: #94a3b8; font-family: monospace; }

        .value { font-weight: 900; color: var(--gold); display: flex; align-items: center; gap: 5px; }

        /* Ø§Ù„Ø´Ø§Ø±Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
        .mini-badge { font-size: 0.7rem; background: var(--primary); color: white; padding: 2px 6px; border-radius: 5px; margin-right: 5px; }

        /* Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) Ù„Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-content {
            background: #1e293b;
            width: 100%;
            max-width: 400px;
            border-radius: 30px;
            padding: 30px;
            text-align: center;
            position: relative;
            border: 1px solid var(--primary);
        }
        .close-modal { position: absolute; top: 20px; left: 20px; color: #94a3b8; cursor: pointer; font-size: 1.5rem; }

        .profile-img {
            width: 100px; height: 100px; background: var(--accent);
            border-radius: 50%; margin: 0 auto 15px;
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem; border: 4px solid var(--primary);
        }
        .badges-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 15px; }
        .badge-tag { background: rgba(99, 102, 241, 0.2); border: 1px solid var(--primary); padding: 5px 12px; border-radius: 10px; font-size: 0.8rem; color: #fff; }

        #loading { text-align: center; margin-top: 50px; }
    </style>
</head>
<body>

    <h2><i class="fas fa-trophy"></i> Ù‚Ø§Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡ÙŠØ±</h2>

    <div id="loading">
        <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--accent);"></i>
        <p>Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ±...</p>
    </div>

    <div class="leaderboard-container">
        <div id="coins-leaderboard" class="leaderboard-card">
            <h3><i class="fas fa-coins"></i> ÙƒØ¨Ø§Ø± Ø§Ù„Ø£Ø«Ø±ÙŠØ§Ø¡</h3>
        </div>
        
        <div id="xp-leaderboard" class="leaderboard-card">
            <h3><i class="fas fa-star"></i> Ø£Ù‚ÙˆÙ‰ Ø§Ù„Ù…Ø­ØªØ§Ù„ÙŠÙ† (XP)</h3>
        </div>
    </div>

    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div class="profile-img" id="modal-img"><i class="fas fa-user"></i></div>
            <h2 id="modal-name" style="margin-bottom: 5px;">---</h2>
            <p id="modal-uid" style="color: var(--gold); font-family: monospace;"></p>
            
            <div id="modal-stats" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                </div>

            <div class="badges-container" id="modal-badges">
                </div>

            <button onclick="addFriendAction()" style="width: 100%; margin-top: 20px; padding: 12px; border-radius: 12px; border: none; background: var(--primary); color: white; font-weight: 900; cursor: pointer;">
                <i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© ØµØ¯ÙŠÙ‚
            </button>
        </div>
    </div>

<script>
    const ADMIN_EMAIL = "clansp245@gmail.com";
    const usersRef = db.collection('users');

    async function loadLeaderboards() {
        const coinsSnap = await usersRef.orderBy('totalCoins', 'desc').limit(10).get();
        const xpSnap = await usersRef.orderBy('xp', 'desc').limit(10).get();
        
        document.getElementById('loading').style.display = 'none';
        
        renderList('coins-leaderboard', coinsSnap, 'totalCoins', 'fa-coins');
        renderList('xp-leaderboard', xpSnap, 'xp', 'fa-star');
    }

    function renderList(containerId, snapshot, field, icon) {
        const container = document.getElementById(containerId);
        let index = 1;
        
        snapshot.forEach(doc => {
            const user = doc.data();
            const playerDiv = document.createElement('div');
            playerDiv.className = 'player-item';
            playerDiv.onclick = () => openProfile(user);
            
            playerDiv.innerHTML = `
                <span class="rank">${index++}</span>
                <div class="info">
                    <span class="name">${user.displayName || 'Ù„Ø§Ø¹Ø¨ Ù…Ø¬Ù‡ÙˆÙ„'} ${user.email === ADMIN_EMAIL ? 'ğŸ‘‘' : ''}</span>
                    <span class="public-uid">${user.publicUid || '---'}</span>
                </div>
                <span class="value">${user[field].toLocaleString()} <i class="fas ${icon}"></i></span>
            `;
            container.appendChild(playerDiv);
        });
    }

    // ÙØªØ­ Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨
    function openProfile(user) {
        document.getElementById('modal-name').innerText = user.displayName || "Ù„Ø§Ø¹Ø¨";
        document.getElementById('modal-uid').innerText = user.publicUid || "Ø¨Ø¯ÙˆÙ† ID";
        document.getElementById('modal-stats').innerHTML = `
            <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px;">
                <div style="font-size: 0.7rem; color: #94a3b8;">Ø§Ù„ÙƒÙˆÙŠÙ†Ø²</div>
                <div style="color: var(--gold); font-weight: 900;">${user.totalCoins || 0}</div>
            </div>
            <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px;">
                <div style="font-size: 0.7rem; color: #94a3b8;">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
                <div style="color: var(--accent); font-weight: 900;">${user.level || 1}</div>
            </div>
        `;

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø§Ø±Ø§Øª (Badges)
        const badgesBox = document.getElementById('modal-badges');
        badgesBox.innerHTML = '';
        
        if (user.email === ADMIN_EMAIL) badgesBox.innerHTML += '<span class="badge-tag" style="border-color: #ef4444;">ğŸ› ï¸ Ø§Ù„Ù…Ø·ÙˆØ±</span>';
        if (isPro(user)) badgesBox.innerHTML += '<span class="badge-tag" style="border-color: var(--gold);">ğŸ‘‘ Ø¹Ø¶Ùˆ PRO</span>';
        if ((user.xp || 0) > 10000) badgesBox.innerHTML += '<span class="badge-tag">ğŸ”¥ Ø£Ø³Ø·ÙˆØ±ÙŠ</span>';
        
        document.getElementById('profileModal').style.display = 'flex';
    }

    function closeModal() { document.getElementById('profileModal').style.display = 'none'; }

    function addFriendAction() {
        alert("Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¯Ù…!");
    }

    firebase.auth().onAuthStateChanged(user => {
        if (user) loadLeaderboards();
        else window.location.href = "auth.html";
    });
</script>
</body>
</html>

