<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ•µï¸ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</title>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="auth.js"></script> <link href="https://fonts.googleapis.com/css2?family=Cairo:wght=400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
/* (ØªÙ†Ø³ÙŠÙ‚Ø§Øª CSS Ø§Ù„ØªÙŠ Ù‚Ù…Øª Ø¨ØªÙˆÙÙŠØ±Ù‡Ø§) */
body {
  font-family: 'Cairo', sans-serif;
  background-color: #0f172a; 
  color: #f1f5f9; 
  text-align: center;
  padding: 20px;
  min-height: 100vh;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-around; 
}

#player {
    font-size: 2rem;
    font-weight: 700;
    margin-top: 50px;
    color: #34d399; 
    min-height: 30px; 
}

#card {
  width: 300px; 
  height: 200px; 
  background-color: #1e293b; 
  color: #f1f5f9;
  border-radius: 15px;
  margin: 50px auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4); 
  transition: transform 0.3s ease-out, background-color 0.3s;
}

.instruction-text {
    font-size: 16px;
    font-weight: 400;
    margin-top: 10px;
    color: #94a3b8;
}

#card.revealed {
    background-color: #6366f1; 
    color: #ffffff;
    transform: translateY(-20px); 
    box-shadow: 0 12px 20px rgba(99, 102, 241, 0.5); 
}

button {
  margin-top: 30px;
  padding: 12px 30px;
  font-size: 18px;
  font-weight: 700;
  border: none;
  border-radius: 8px; 
  cursor: pointer;
  transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
  background-color: #6366f1; 
  color: #ffffff;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
}

#home-icon {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 24px;
    color: #94a3b8;
    cursor: pointer;
    transition: color 0.3s;
}

#timer-container {
    font-size: 2.5rem;
    font-weight: 700;
    color: #ffcc00; 
    margin-top: 30px;
    display: none; 
}

#end-message {
    font-size: 1.5rem;
    color: #34d399;
    margin: 20px;
    display: none;
}

#coin-display {
    position: absolute;
    top: 20px;
    left: 20px;
    font-size: 1.2rem;
    font-weight: 700;
    color: #ffd700; 
}

</style>
</head>

<body onload="loadGameData()">

<a href="index.html" id="home-icon" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
    <i class="fas fa-home"></i>
</a>

<div id="coin-display">
    <i class="fas fa-coins"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total-coins-value">0</span>
</div>

<h2 id="player"></h2>

<div id="card" ontouchstart="show()" ontouchend="hide()" onmousedown="show()" onmouseup="hide()">
    <span>Ø§Ø³Ø­Ø¨ Ø£Ùˆ Ø§Ø¶ØºØ· Ù…Ø¹ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±</span>
    <div class="instruction-text">Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø¯ÙˆØ±Ùƒ</div>
</div>

<button id="nextBtn" onclick="next()">Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-arrow-left"></i></button>

<div id="timer-container">00:00</div>

<div id="end-message"></div>

<script>
// ** ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ·Ø§Ø¨Ù‚Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ settings.html **
const wordCategories = {
    free: [
        { id: 'objects', words: ["Ù‚Ù„Ù…", "ÙƒÙˆØ¨", "ÙƒØ±Ø³ÙŠ", "Ù…ÙØªØ§Ø­", "Ù‡Ø§ØªÙ", "ÙƒØªØ§Ø¨", "Ø³Ø§Ø¹Ø©", "Ù…ØµØ¨Ø§Ø­", "Ù…Ù„Ø¹Ù‚Ø©", "Ø­Ø°Ø§Ø¡", "Ø­Ù‚ÙŠØ¨Ø©", "Ø·Ø§ÙˆÙ„Ø©", "Ù…Ø±Ø¢Ø©", "Ø¯ÙØªØ±", "Ù…Ù…Ø­Ø§Ø©", "Ø¬Ø¯Ø§Ø±", "Ø´Ø¨Ø§Ùƒ", "Ø¨Ø§Ø¨", "Ø³Ø±ÙŠØ±", "ÙˆØ³Ø§Ø¯Ø©", "ØºØ·Ø§Ø¡", "Ø¬Ø±Ø³", "Ù…Ø¸Ù„Ø©", "Ù„ÙˆØ­Ø©", "Ù…Ø±ÙˆØ­Ø©", "ØµÙ†Ø¯ÙˆÙ‚", "ÙØ±Ø´Ø§Ø©", "Ù…Ø´Ø·", "Ù…Ù…Ø­Ø§Ø©", "Ù…Ø·Ø±Ù‚Ø©", "Ù…Ø³Ù…Ø§Ø±", "Ø®ÙŠØ·", "Ø¥Ø¨Ø±Ø©", "Ø®Ø²Ø§Ù†Ø©", "Ø­Ø¨Ù„", "Ø´Ø±ÙŠØ·", "ÙƒØ§Ù…ÙŠØ±Ø§", "Ù…Ø§ÙˆØ³", "Ø¨Ø·Ø§Ø±ÙŠØ©", "Ù„Ù…Ø¨Ø©", "Ù…Ù‚Øµ", "Ù…Ù†Ø´ÙØ©", "ØµÙ†Ø¨ÙˆØ±", "Ù‚ÙÙ„", "Ø³Ù„Ø©", "Ø³Ù„Ùƒ", "Ø´Ø§Ø­Ù†", "Ø£Ø±ÙŠÙƒØ©", "Ø±Ù"] },
        { id: 'nature', words: ["Ø´Ø¬Ø±Ø©", "Ù†Ù‡Ø±", "Ø¬Ø¨Ù„", "Ø³Ù…Ø§Ø¡", "Ø¨Ø­Ø±", "Ø´Ù…Ø³", "Ù‚Ù…Ø±", "Ù†Ø¬Ù…", "ØºÙŠÙ…Ø©", "Ù…Ø·Ø±", "Ø«Ù„Ø¬", "ØµØ®Ø±Ø©", "Ø±Ù…Ù„", "Ø¹Ø´Ø¨", "ÙˆØ±Ø¯Ø©", "Ù†Ø®Ù„Ø©", "Ø´Ø§Ø·Ø¦", "Ø¨Ø±ÙƒØ§Ù†", "ØµØ­Ø±Ø§Ø¡", "ÙˆØ§Ø¯ÙŠ", "ÙƒÙ‡Ù", "Ø¨Ø­ÙŠØ±Ø©", "Ø¶Ø¨Ø§Ø¨", "Ø±ÙŠØ§Ø­", "ØµÙ‚ÙŠØ¹", "ØªØ±Ø§Ø¨", "Ù†Ø¨ØªØ©", "Ø¨Ø°Ø±Ø©", "ÙØ¶Ø§Ø¡", "ÙƒÙˆÙƒØ¨", "Ø´Ù‡Ø§Ø¨", "Ø£ÙÙ‚", "Ø¬Ø³Ø±", "Ù…Ø²Ø±Ø¹Ø©", "Ø¹Ø§ØµÙØ©", "Ù†Ø³ÙŠÙ…", "Ø¸Ù„", "Ø¶ÙˆØ¡", "Ù…Ø­ÙŠØ·", "Ø¬Ø²ÙŠØ±Ø©", "Ø´Ù„Ø§Ù„", "Ù†Ø¨Ø¹", "Ø¬Ø°Ø¹", "ÙˆØ±Ù‚Ø©", "ØºØ§Ø¨Ø©", "Ø£Ø²Ù‡Ø§Ø±", "Ø³Ø­Ø§Ø¨Ø©", "Ø¨Ø¦Ø±"] },
        { id: 'jobs', words: ["Ø·Ø¨ÙŠØ¨", "Ù…Ø¹Ù„Ù…", "Ù…Ù‡Ù†Ø¯Ø³", "Ø´Ø±Ø·ÙŠ", "Ø®Ø¨Ø§Ø²", "Ù…Ø²Ø§Ø±Ø¹", "Ù†Ø¬Ø§Ø±", "Ø·Ø¨Ø§Ø®", "Ø±Ø³Ø§Ù…", "Ù…Ø°ÙŠØ¹", "Ù‚Ø§Ø¶ÙŠ", "ÙƒØ§ØªØ¨", "Ø¬Ù†Ø¯ÙŠ", "Ø¨Ø­Ø§Ø±", "Ø·ÙŠØ§Ø±", "ØµÙŠØ¯Ù„ÙŠ", "Ù…Ù…Ø±Ø¶", "Ù…ØµÙˆØ±", "Ù…ÙˆØ³ÙŠÙ‚ÙŠ", "Ø®ÙŠØ§Ø·", "Ø³Ø§Ø¦Ù‚", "Ù…Ø­Ø§Ù…ÙŠ", "Ø¨Ø§Ø¦Ø¹", "Ù…ØªØ±Ø¬Ù…", "Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ", "Ø¨Ù†Ø§Ø¡", "ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ", "Ø­Ø¯Ø§Ø¯", "Ø¬Ø²Ø§Ø±", "Ø´Ø§Ø¹Ø±", "ØµØ­ÙÙŠ", "Ù†Ø§Ù‚Ø¯", "Ø­Ø§Ø±Ø³", "Ø±ÙŠØ§Ø¶ÙŠ", "Ø¹Ø§Ù…Ù„", "Ø¥Ø·ÙØ§Ø¦ÙŠ", "Ù…Ø±Ø´Ø¯", "Ø®Ø§Ø¯Ù…", "Ù…Ø­Ø§Ø³Ø¨", "Ù…Ø¯Ø±Ø¨", "ÙÙ†Ø§Ù†", "ØµØ§Ù†Ø¹", "Ù…ÙˆØ²Ø¹", "Ù…ÙØªØ´", "Ø¹Ø§Ù„Ù…", "ÙÙ„ÙƒÙŠ", "Ù…Ø±Ø§Ø³Ù„"] }
    ],
    pro: [
        { id: 'foods', words: ["ØªÙØ§Ø­", "Ù…ÙˆØ²", "Ø¨Ø±ØªÙ‚Ø§Ù„", "Ù…Ø§Ø¡", "Ù‚Ù‡ÙˆØ©", "Ø´Ø§ÙŠ", "Ø®Ø¨Ø²", "Ø£Ø±Ø²", "Ù„Ø­Ù…", "Ø¯Ø¬Ø§Ø¬", "Ø³Ù…Ùƒ", "Ø¹ØµÙŠØ±", "Ø­Ù„ÙŠØ¨", "Ø¬Ø¨Ù†", "Ø¨ÙŠØ¶", "Ø³ÙƒØ±", "Ù…Ù„Ø­", "Ø²ÙŠØª", "Ø²Ø¨Ø¯Ø©", "Ø¹Ø³Ù„", "Ø¨Ø·Ø§Ø·Ø§", "Ø·Ù…Ø§Ø·Ù…", "Ø¨ØµÙ„", "Ø«ÙˆÙ…", "Ø®Ø³", "Ø¬Ø²Ø±", "ÙƒØ¹ÙƒØ©", "Ù…Ø«Ù„Ø¬Ø§Øª", "Ù…ÙƒØ±ÙˆÙ†Ø©", "Ø¨ÙŠØªØ²Ø§", "Ø³Ù„Ø·Ø©", "Ø­Ø³Ø§Ø¡", "ØªÙˆØ§Ø¨Ù„", "Ù…Ø´Ø±ÙˆØ¨", "Ø¹Ù†Ø¨", "Ù…Ø§Ù†Ø¬Ùˆ", "ÙÙ„ÙÙ„", "Ù„ÙŠÙ…ÙˆÙ†", "Ø¨Ø³ÙƒÙˆÙŠØª", "ÙÙˆÙ„", "Ø¹Ø¯Ø³", "ÙØ±Ø§ÙˆÙ„Ø©", "Ø²ÙŠØªÙˆÙ†", "Ù…Ø±Ø¨Ù‰", "Ø³ÙƒØ±", "Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©", "ÙØ·Ø±", "Ø¹Ù„ÙƒØ©"] },
        { id: 'animals', words: ["ÙƒÙ„Ø¨", "Ù‚Ø·Ø©", "Ø£Ø³Ø¯", "Ù†Ù…Ø±", "ÙÙŠÙ„", "Ø²Ø±Ø§ÙØ©", "Ù‚Ø±Ø¯", "Ø­ØµØ§Ù†", "Ø¬Ù…Ù„", "Ø¶ÙØ¯Ø¹", "Ø«Ø¹Ù„Ø¨", "Ø°Ø¦Ø¨", "Ø¯Ø¨", "Ø£Ø±Ù†Ø¨", "Ø³Ù†Ø¬Ø§Ø¨", "Ø·Ø§Ø¦Ø±", "Ø­Ù…Ø§Ù…Ø©", "ØµÙ‚Ø±", "Ø¨ÙˆÙ…Ø©", "Ù†Ø³Ø±", "Ø¨Ø·Ø©", "Ø¯ÙŠÙƒ", "Ø¯Ø¬Ø§Ø¬Ø©", "Ø¨Ù‚Ø±Ø©", "ØºØ²Ø§Ù„", "ØªÙ…Ø³Ø§Ø­", "Ø«Ø¹Ø¨Ø§Ù†", "Ø³Ù…ÙƒØ©", "Ù‚Ø±Ø´", "Ø¯ÙˆÙ„ÙÙŠÙ†", "Ø­ÙˆØª", "Ù†Ø­Ù„Ø©", "Ù†Ù…Ù„Ø©", "Ø¹Ù†ÙƒØ¨ÙˆØª", "ÙØ±Ø§Ø´Ø©", "ÙŠØ±Ø¨ÙˆØ¹", "Ø³Ù„Ø­ÙØ§Ø©", "Ø®Ø±ÙˆÙ", "Ù…Ø§Ø¹Ø²", "ÙØ£Ø±", "Ø¨Ø¨ØºØ§Ø¡", "ÙƒÙ†ØºØ±", "Ø¨Ø·Ø±ÙŠÙ‚", "Ø¶Ø¨Ø¹", "Ù†ÙˆØ±Ø³", "Ø¹Ù‚Ø§Ø¨", "Ø³Ø¹Ø¯Ø§Ù†"] },
        { id: 'clothes', words: ["Ù‚Ù…ÙŠØµ", "Ø¨Ù†Ø·Ø§Ù„", "ÙØ³ØªØ§Ù†", "ØªÙ†ÙˆØ±Ø©", "Ù…Ø¹Ø·Ù", "Ø³ØªØ±Ø©", "Ø­Ø¬Ø§Ø¨", "ÙˆØ´Ø§Ø­", "Ù‚Ø¨Ø¹Ø©", "Ø¬ÙˆØ±Ø¨", "Ù‚ÙØ§Ø²", "Ø­Ø°Ø§Ø¡", "ØµÙ†Ø¯Ù„", "Ø­Ù‚ÙŠØ¨Ø©", "Ù†Ø¸Ø§Ø±Ø©", "Ø­Ø²Ø§Ù…", "Ø³Ø§Ø¹Ø© ÙŠØ¯", "Ø®Ø§ØªÙ…", "Ù‚Ù„Ø§Ø¯Ø©", "Ø³ÙˆØ§Ø±", "Ø¬ÙŠØ¨", "Ø²Ø±", "Ø³Ø­Ø§Ø¨", "Ù‚Ù…Ø§Ø´", "Ø­Ø±ÙŠØ±", "Ø¬Ù„Ø¯", "Ù‚Ø·Ù†", "ØµÙˆÙ", "Ø¹Ø¨Ø§Ø¡Ø©", "Ø¨ÙŠØ¬Ø§Ù…Ø©", "Ø±Ø¨Ø·Ø© Ø¹Ù†Ù‚", "Ù…Ø±ÙŠÙˆÙ„", "ÙƒØ¨Ùƒ", "ÙØ±Ùˆ", "Ø´Ø§Ù„", "ØµØ¯Ø±ÙŠØ©", "Ù…Ù†Ø´ÙØ©", "Ù…Ù†Ø§Ù…Ø©", "Ù‚Ø¨Ø¹Ø© Ø´Ù…Ø³", "Ù…Ø´Ø¯", "Ø²ÙŠ", "Ø¨Ø§Ø±ÙˆÙƒØ©", "Ø¨ÙˆØª", "Ø¬ÙˆØ§Ø±Ø¨", "Ù„Ø¨Ø§Ø³", "Ø±Ø¯Ø§Ø¡", "Ù…Ø¦Ø²Ø±", "Ø³Ø±ÙˆØ§Ù„"] },
        { id: 'places', words: ["Ù…Ø¯Ø±Ø³Ø©", "Ù…Ø³ØªØ´ÙÙ‰", "Ù…Ù†Ø²Ù„", "Ù…Ø³Ø¬Ø¯", "ÙƒÙ†ÙŠØ³Ø©", "Ø³ÙˆÙ‚", "Ù…ÙƒØªØ¨Ø©", "Ù…Ø·Ø§Ø±", "Ù…Ø­Ø·Ø©", "Ø­Ø¯ÙŠÙ‚Ø©", "Ù…ØªØ­Ù", "Ù…ØµÙ†Ø¹", "Ù…Ù‚Ù‡Ù‰", "Ù…Ø·Ø¹Ù…", "ÙÙ†Ø¯Ù‚", "Ù…Ø¨Ù†Ù‰", "Ø¬Ø³Ø±", "Ø·Ø±ÙŠÙ‚", "Ø´Ø§Ø±Ø¹", "Ø³Ø§Ø­Ø©", "Ù‚ØµØ±", "Ù‚Ù„Ø¹Ø©", "Ø¨Ø±Ø¬", "Ø¨ÙˆØ§Ø¨Ø©", "Ø¨Ø¦Ø±", "Ù…Ù„Ø¹Ø¨", "Ù†Ø§Ø¯ÙŠ", "Ø¬Ø§Ù…Ø¹Ø©", "ÙˆØ²Ø§Ø±Ø©", "Ø³ÙØ§Ø±Ø©", "ÙƒØ±Ø§Ø¬", "Ù†ÙÙ‚", "Ù…Ù…Ø±", "Ù‚Ø¨Ùˆ", "Ø³Ø·Ø­", "Ø´Ø±ÙØ©", "Ù…Ø®Ø²Ù†", "Ù…ÙˆÙ‚Ù", "ØºØ±ÙØ©", "Ù‚Ø§Ø¹Ø©", "Ø¨Ù‡Ùˆ", "Ù…Ø³ØªÙˆØ¯Ø¹", "Ù…Ø¬Ù„Ø³", "Ø®ÙŠÙ…Ø©", "Ù…Ø®Ø¨Ø²", "Ù…ØºØ³Ù„Ø©", "Ø¯ÙƒØ§Ù†"] },
        { id: 'activities', words: ["Ø¬Ø±ÙŠ", "Ø³Ø¨Ø§Ø­Ø©", "Ù‚Ø±Ø§Ø¡Ø©", "ÙƒØªØ§Ø¨Ø©", "Ø±Ø³Ù…", "ØºÙ†Ø§Ø¡", "Ø±Ù‚Øµ", "Ù„Ø¹Ø¨", "Ù†ÙˆÙ…", "Ø£ÙƒÙ„", "Ø´Ø±Ø¨", "Ø¶Ø­Ùƒ", "Ø¨ÙƒØ§Ø¡", "ØµØ±Ø§Ø®", "Ù…Ø´Ø§Ù‡Ø¯Ø©", "Ø§Ø³ØªÙ…Ø§Ø¹", "Ø­Ø¯ÙŠØ«", "Ø³ÙØ±", "ØµÙŠØ¯", "Ø·Ø¨Ø®", "ØªÙ†Ø¸ÙŠÙ", "Ø¹Ù…Ù„", "Ø¯Ø±Ø§Ø³Ø©", "Ù‚ÙŠØ§Ø¯Ø©", "Ø¨Ù†Ø§Ø¡", "Ù‡Ø¯Ù…", "Ø²Ø±Ø¹", "Ø­ØµØ§Ø¯", "Ø¥ØµÙ„Ø§Ø­", "ÙƒØ³Ø±", "ÙØªØ­", "Ø¥ØºÙ„Ø§Ù‚", "Ù‚ÙØ²", "ØµØ¹ÙˆØ¯", "Ù‡Ø¨ÙˆØ·", "Ø§Ù†ØªØ¸Ø§Ø±", "ØªÙÙƒÙŠØ±", "Ø­Ù„Ù…", "Ø¨Ù‚Ø§Ø¡", "ØªØ£Ù…Ù„", "ØªØ¬ÙˆÙ„", "Ø§Ø³ØªØ±Ø§Ø­Ø©", "Ø§Ø¬ØªÙ…Ø§Ø¹", "Ø¥Ø´Ø§Ø±Ø©", "Ø¥Ø±Ø³Ø§Ù„", "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„", "Ø³Ø¤Ø§Ù„"] },
        { id: 'adjectives', words: ["Ø³Ø±ÙŠØ¹", "Ø¨Ø·ÙŠØ¡", "ÙƒØ¨ÙŠØ±", "ØµØºÙŠØ±", "Ø·ÙˆÙŠÙ„", "Ù‚ØµÙŠØ±", "Ø¬Ù…ÙŠÙ„", "Ù‚Ø¨ÙŠØ­", "Ø³Ø¹ÙŠØ¯", "Ø­Ø²ÙŠÙ†", "ØºØ§Ø¶Ø¨", "Ù‡Ø§Ø¯Ø¦", "ØµØ§Ø®Ø¨", "Ù†Ø¸ÙŠÙ", "Ù…ØªØ³Ø®", "Ù‚ÙˆÙŠ", "Ø¶Ø¹ÙŠÙ", "Ø¨Ø§Ø±Ø¯", "Ø­Ø§Ø±", "Ù…Ø´Ø±Ù‚", "Ù…Ø¸Ù„Ù…", "Ø¬Ø¯ÙŠØ¯", "Ù‚Ø¯ÙŠÙ…", "ØµØ¹Ø¨", "Ø³Ù‡Ù„", "Ø®ÙÙŠÙ", "Ø«Ù‚ÙŠÙ„", "Ø¬Ø§Ø¦Ø¹", "Ø¹Ø·Ø´Ø§Ù†", "Ù…Ø±ÙŠØ¶", "Ø³Ù„ÙŠÙ…", "Ø¨Ø¹ÙŠØ¯", "Ù‚Ø±ÙŠØ¨", "Ø­Ù‚ÙŠÙ‚ÙŠ", "ÙˆÙ‡Ù…ÙŠ", "Ø´Ø¬Ø§Ø¹", "Ø¬Ø¨Ø§Ù†", "Ù…Ø¶Ø­Ùƒ", "Ø¬Ø¯ÙŠ", "Ù…Ø£Ù„ÙˆÙ", "ØºØ±ÙŠØ¨", "Ø­ÙƒÙŠÙ…", "Ø£Ø­Ù…Ù‚", "Ù†Ø§Ø¬Ø­", "ÙØ§Ø´Ù„"] }
    ]
};

let players = JSON.parse(localStorage.getItem("players") || "[]");
let settings = JSON.parse(localStorage.getItem("settings") || "{}");

const playerDisplay = document.getElementById("player");
const card = document.getElementById("card");
const nextBtn = document.getElementById("nextBtn");
const timerContainer = document.getElementById("timer-container");
const endMessage = document.getElementById("end-message");
const totalCoinsValue = document.getElementById("total-coins-value");

let i = 0; 
let roles = []; 
let civilWord = ""; 
let impostorWord = ""; 
const IMP = "IMPOSTOR_ROLE_MARKER"; 
const NW = "NO_WORD_ROLE_MARKER";   
let timerInterval;
let gameCompleted = false; 

let currentUserData = { totalCoins: 0, proExpiryTime: 0 }; 

/**
 * @function loadGameData
 * @description ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©.
 */
async function loadGameData() {
     firebase.auth().onAuthStateChanged(async (user) => {
        if (!user) {
            alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
            window.location.href = "auth.html";
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØµØ­ÙŠØ­Ø© ÙˆØ£Ù‚Ø³Ø§Ù… Ù…Ø®ØªØ§Ø±Ø©
        if (players.length < 3 || !settings || !settings.selectedCategories || settings.selectedCategories.length === 0) {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ 3 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ÙˆØ§Ø®ØªÙŠØ§Ø± Ù‚Ø³Ù… ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.");
            location.href = "settings.html"; 
            return;
        }
        
        const data = await loadUserData(); // Ù…Ù† auth.js
        if (data) {
            currentUserData = data;
        }
        
        displayTotalCoins(); 
        setupGameRoles();
        playerDisplay.innerText = `Ø¯ÙˆØ±: ${players[i]}`; 
    });
}


// ----------------------------------
// 1. Ù…Ù†Ø·Ù‚ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²Ø§Øª ÙˆØ§Ù„Ù€ Pro (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±)
// ----------------------------------

function isPro() {
    const proExpiryTime = currentUserData.proExpiryTime || 0; 
    return proExpiryTime > new Date().getTime();
}

function getTotalCoins() {
    return currentUserData.totalCoins || 0;
}

function displayTotalCoins() {
    totalCoinsValue.innerText = getTotalCoins();
}

/**
 * @function calculateAndAddCoins
 * @description Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ÙƒÙˆÙŠÙ†Ø² Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø© (Ù…Ù† 5 Ø¥Ù„Ù‰ 15) ÙˆØ¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¹Ø¨Ø± Firestore.
 */
async function calculateAndAddCoins() {
    const proMultiplier = isPro() ? 1.5 : 1; 
    const minCoins = 5;
    const maxCoins = 15; 
    const baseCoins = Math.floor(Math.random() * (maxCoins - minCoins + 1)) + minCoins; 
    const coinsEarned = Math.floor(baseCoins * proMultiplier);
    
    const currentCoins = getTotalCoins();
    const newTotalCoins = currentCoins + coinsEarned;
    
    const saveSuccessful = await saveUserData(newTotalCoins, currentUserData.proExpiryTime || 0);
    
    if (saveSuccessful) {
        currentUserData.totalCoins = newTotalCoins; 
        displayTotalCoins();
        
        alert(`ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø±Ø¨Ø­Øª ${coinsEarned} ÙƒÙˆÙŠÙ†Ø²Ù‹Ø§ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø©. ${isPro() ? '(Ù…ÙƒØ§ÙØ£Ø© Pro Ù…Ø·Ø¨Ù‚Ø©!)' : ''} Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²Ø§Øª Ø§Ù„Ø¢Ù†: ${newTotalCoins}`);
    } else {
        console.error("ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²Ø§Øª.");
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.");
    }
    
    return coinsEarned;
}

// ----------------------------------
// 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± (Ø§Ù„Ù…ÙØµØ­Ù‘ÙØ­ ÙˆØ§Ù„Ù…ÙØ­Ø¯Ù‘ÙØ«)
// ----------------------------------

function setupGameRoles() {
    const isUserPro = isPro(); 
    let allWords = [];
    const selectedIds = settings.selectedCategories || [];
    
    // 1. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© ÙÙ‚Ø·
    const allCategories = wordCategories.free.concat(wordCategories.pro);
    
    allCategories.forEach(category => {
        if (selectedIds.includes(category.id)) {
            const isProCategory = wordCategories.pro.some(p => p.id === category.id);
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø¬Ø§Ù†ÙŠØ© Ø£Ùˆ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Pro
            if (!isProCategory || isUserPro) { 
                allWords.push(...category.words);
            }
        }
    });

    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª
    allWords = [...new Set(allWords)];

    if (allWords.length === 0) {
        alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª ÙÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.");
        location.href = "settings.html";
        return;
    }
    
    // 2. ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø¯Ù†ÙŠØ© ÙˆØ§Ù„Ù…Ø­ØªØ§Ù„
    let wordIndex1 = Math.floor(Math.random() * allWords.length);
    civilWord = allWords[wordIndex1];
    impostorWord = civilWord; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©

    if (settings.multiWordMode === true && allWords.length >= 2) {
        let availableWords = allWords.filter((w, index) => index !== wordIndex1);
        impostorWord = availableWords[Math.floor(Math.random() * availableWords.length)]; 
    }
    
    let totalPlayers = players.length;
    roles = Array(totalPlayers).fill(null); 
    
    // 3. ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹ (Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù…Ø­ØªØ§Ù„ Ù„ÙŠØ³ Ø£ÙˆÙ„ Ø´Ø®Øµ)
    let indices = Array.from({length: totalPlayers}, (v, k) => k).sort(() => Math.random() - 0.5);
    
    // 4. ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ØºÙŠØ± Ø§Ù„Ù…Ø¯Ù†ÙŠØ©
    
    // Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù€ Manual/Chaos (Ø¥Ø°Ø§ ØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§)
    const hasManualRoles = isUserPro && (settings.manualImpostors && settings.manualImpostors.length > 0 || settings.manualNoWord && settings.manualNoWord.length > 0);
    
    if (hasManualRoles) {
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„ÙŠØ¯ÙˆÙŠØ©
        settings.manualImpostors.forEach(name => {
            const playerIndex = players.indexOf(name);
            if (playerIndex !== -1) roles[playerIndex] = IMP;
        });

        settings.manualNoWord.forEach(name => {
            const playerIndex = players.indexOf(name);
            // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø­ØªØ§Ù„ ÙˆØ¨Ù„Ø§ ÙƒÙ„Ù…Ø©
            if (playerIndex !== -1 && roles[playerIndex] !== IMP) roles[playerIndex] = NW;
        });
        
    } else if (settings.chaosMode === true && isUserPro && Math.random() < 0.20) {
        // ÙˆØ¶Ø¹ Ø§Ù„ÙÙˆØ¶Ù‰ (Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© 20% Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ØºÙŠØ± Ø§Ù„Ù…Ø¯Ù†ÙŠØ©)
        roles = Array(totalPlayers).fill(IMP); 
        let numNoWordChaos = Math.floor(totalPlayers * 0.2); 
        for (let j = 0; j < numNoWordChaos && j < totalPlayers; j++) {
            roles[indices[j]] = NW; 
        }
        
    } else {
        // Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ ÙˆØ§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ø§Ù„Ù…Ø­ØªØ§Ù„ Ù„ÙŠØ³ Ø£ÙˆÙ„ Ø´Ø®Øµ)
        const numImpostors = settings.impostors || 1; 
        let numNoWord = settings.noWordRole === true && totalPlayers > numImpostors ? 1 : 0; 
        let currentImpostors = 0;
        let currentNoWord = 0;
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
        for (let j = 0; j < totalPlayers; j++) {
            const index = indices[j]; // Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
            
            if (currentImpostors < numImpostors) {
                roles[index] = IMP;
                currentImpostors++;
            } else if (currentNoWord < numNoWord) {
                roles[index] = NW;
                currentNoWord++;
            } 
        }
    }
    
    // 5. ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¯Ù†ÙŠÙŠÙ† (Ù„Ø¬Ù…ÙŠØ¹ Ù…Ù† Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø¯ÙˆØ± ØºÙŠØ± Ù…Ø¯Ù†ÙŠ Ù„Ù‡)
    for (let k = 0; k < totalPlayers; k++) {
        if (roles[k] === null) {
            roles[k] = civilWord;
        }
    }

    // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† ÙŠØªÙ… Ø¹Ø±Ø¶Ù‡Ù… Ø¨ØªØ±ØªÙŠØ¨Ù‡Ù… Ø§Ù„Ø£ØµÙ„ÙŠ ÙÙŠ Ù…ØµÙÙˆÙØ© 'players'
    // Ù„ÙƒÙ† Ø£Ø¯ÙˆØ§Ø±Ù‡Ù… (roles[k]) Ù‡ÙŠ Ø§Ù„ØªÙŠ ØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡Ø§ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹.
}


// ----------------------------------
// 3. Ø¯ÙˆØ§Ù„ ØªÙØ§Ø¹Ù„ÙŠØ© (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±)
// ----------------------------------

function show() {
  card.classList.add("revealed");
  
  const roleMarker = roles[i];
  let displayWord = "";
  
  if (roleMarker === civilWord) {
      displayWord = `<span style="color: #34d399;">Ø¯ÙˆØ±Ùƒ: Ø§Ù„Ù…Ø¯Ù†ÙŠ</span>`;
      displayWord += `<div class="instruction-text" style="font-size: 1.5rem; color: #f1f5f9; margin-top: 10px;">Ø§Ù„ÙƒÙ„Ù…Ø©: ${civilWord}</div>`;
  } 
  else if (roleMarker === NW) {
      displayWord = `<span style="color: #6366f1;">Ù„Ø§ ÙƒÙ„Ù…Ø© Ù„Ùƒ!</span>`;
  }
  else if (roleMarker === IMP) {
      displayWord = `<span style="color: #ff4f4f;">Ø¯ÙˆØ±Ùƒ: Ø§Ù„Ù…Ø­ØªØ§Ù„ ğŸ˜ˆ</span>`;
      if (settings.multiWordMode === true) {
           displayWord += `<div class="instruction-text" style="font-size: 1.5rem; color: #f1f5f9; margin-top: 10px;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø­ØªØ§Ù„: ${impostorWord}</div>`;
           displayWord += `<div class="instruction-text" style="font-size: 0.8rem; color: #ffcc00; margin-top: 5px;">*ØªØ°ÙƒÙ‘Ø±ØŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠ Ù‡ÙŠ ${civilWord}*</div>`;
      }
  } 
  else {
      displayWord = `<span style="color: #ffcc00;">Ø®Ø·Ø£: Ø¯ÙˆØ± ØºÙŠØ± Ù…Ø¹Ø±Ù!</span>`;
  }
  
  card.innerHTML = displayWord;
}


function hide() {
  card.classList.remove("revealed");
  card.innerHTML = `<span>Ø§Ø³Ø­Ø¨ Ø£Ùˆ Ø§Ø¶ØºØ· Ù…Ø¹ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±</span><div class="instruction-text">Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø¯ÙˆØ±Ùƒ</div>`;
}

function startTimer(duration) {
    if (duration <= 0) {
        timerContainer.style.display = 'none';
        return; 
    }
    
    timerContainer.style.display = 'block';
    nextBtn.style.display = 'none'; 
    
    let timeRemaining = duration;
    
    function updateTimerDisplay() {
        const minutes = String(Math.floor(timeRemaining / 60)).padStart(2, '0');
        const seconds = String(timeRemaining % 60).padStart(2, '0');
        timerContainer.innerText = `${minutes}:${seconds}`;

        if (timeRemaining <= 0) {
            clearInterval(timerInterval);
            timerContainer.innerText = "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!";
            timerContainer.style.color = '#ff4f4f'; 
            
            gameCompleted = true; 
            calculateAndAddCoins(); 
            
            alert("Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø©! Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„ØªØµÙˆÙŠØª.");
        }
        timeRemaining--;
    }

    updateTimerDisplay(); 
    timerInterval = setInterval(updateTimerDisplay, 1000);
}


function next() {
  if(card.classList.contains("revealed")) {
      hide();
  }
  
  i++;
  
  if(i >= players.length){
    // Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    gameCompleted = true; 

    playerDisplay.innerText = "ØªÙ… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±! Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù†Ù‚Ø§Ø´.";
    card.style.display = 'none'; 
    nextBtn.style.display = 'none'; 
    
    endMessage.style.display = 'block';
    endMessage.innerText = "Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø© ğŸ—£ï¸";

    startTimer(settings.discussionTimer);

    // Ù…Ù†Ø­ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²Ø§Øª ÙÙˆØ±Ø§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø¤Ù‚Øª
    if (settings.discussionTimer === 0) {
        calculateAndAddCoins();
    }
    
    return;
  }
  
  playerDisplay.innerText = `Ø¯ÙˆØ±: ${players[i]}`;
}
</script>

</body>
</html>
