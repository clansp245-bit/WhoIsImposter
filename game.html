<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ•µï¸ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</title>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="auth.js"></script> <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
/* (ØªÙ†Ø³ÙŠÙ‚Ø§Øª CSS Ø§Ù„ØªÙŠ Ù‚Ù…Øª Ø¨ØªÙˆÙÙŠØ±Ù‡Ø§) */
body {
  font-family: 'Cairo', sans-serif;
  background-color: #0f172a; 
  color: #f1f5f9; 
  text-align: center;
  padding: 20px;
  min-height: 100vh;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-around; 
}

#player {
    font-size: 2rem;
    font-weight: 700;
    margin-top: 50px;
    color: #34d399; 
    min-height: 30px; 
}

#card {
  width: 300px; 
  height: 200px; 
  background-color: #1e293b; 
  color: #f1f5f9;
  border-radius: 15px;
  margin: 50px auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4); 
  transition: transform 0.3s ease-out, background-color 0.3s;
}

.instruction-text {
    font-size: 16px;
    font-weight: 400;
    margin-top: 10px;
    color: #94a3b8;
}

#card.revealed {
    background-color: #6366f1; 
    color: #ffffff;
    transform: translateY(-20px); 
    box-shadow: 0 12px 20px rgba(99, 102, 241, 0.5); 
}

button {
  margin-top: 30px;
  padding: 12px 30px;
  font-size: 18px;
  font-weight: 700;
  border: none;
  border-radius: 8px; 
  cursor: pointer;
  transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
  background-color: #6366f1; 
  color: #ffffff;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
}

#home-icon {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 24px;
    color: #94a3b8;
    cursor: pointer;
    transition: color 0.3s;
}

#timer-container {
    font-size: 2.5rem;
    font-weight: 700;
    color: #ffcc00; 
    margin-top: 30px;
    display: none; 
}

#end-message {
    font-size: 1.5rem;
    color: #34d399;
    margin: 20px;
    display: none;
}

#coin-display {
    position: absolute;
    top: 20px;
    left: 20px;
    font-size: 1.2rem;
    font-weight: 700;
    color: #ffd700; 
}

</style>
</head>

<body onload="loadGameData()">

<a href="index.html" id="home-icon" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
    <i class="fas fa-home"></i>
</a>

<div id="coin-display">
    <i class="fas fa-coins"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total-coins-value">0</span>
</div>

<h2 id="player"></h2>

<div id="card" ontouchstart="show()" ontouchend="hide()" onmousedown="show()" onmouseup="hide()">
    <span>Ø§Ø³Ø­Ø¨ Ø£Ùˆ Ø§Ø¶ØºØ· Ù…Ø¹ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±</span>
    <div class="instruction-text">Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø¯ÙˆØ±Ùƒ</div>
</div>

<button id="nextBtn" onclick="next()">Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-arrow-left"></i></button>

<div id="timer-container">00:00</div>

<div id="end-message"></div>

<script>
// âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù…Ø­Ù…Ù„Ù‹Ø§ Ù…Ø³Ø¨Ù‚Ù‹Ø§
let players = JSON.parse(localStorage.getItem("players") || "[]");
let settings = JSON.parse(localStorage.getItem("settings") || "{}");

const playerDisplay = document.getElementById("player");
const card = document.getElementById("card");
const nextBtn = document.getElementById("nextBtn");
const timerContainer = document.getElementById("timer-container");
const endMessage = document.getElementById("end-message");
const totalCoinsValue = document.getElementById("total-coins-value");

let i = 0; 
let roles = []; 
let civilWord = ""; 
let impostorWord = ""; 
const IMP = "IMPOSTOR_ROLE_MARKER"; // Ø¹Ù„Ø§Ù…Ø© Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„Ù…Ø­ØªØ§Ù„
const NW = "NO_WORD_ROLE_MARKER";   // Ø¹Ù„Ø§Ù…Ø© Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù€ "Ø¨Ù„Ø§ ÙƒÙ„Ù…Ø©"
let timerInterval;
let gameCompleted = false; 

let currentUserData = { totalCoins: 0, proExpiryTime: 0 }; 

/**
 * @function loadGameData
 * @description ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©.
 */
async function loadGameData() {
     firebase.auth().onAuthStateChanged(async (user) => {
        if (!user) {
            alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
            window.location.href = "auth.html";
            return;
        }
        
        // ** Ø§ÙØªØ±Ø§Ø¶ Ø£Ù† 'players' Ù‚Ø¯ ØªÙ… Ø­ÙØ¸Ù‡Ø§ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ index.html **
        if (players.length === 0 || !settings || players.length < 3) {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ 3 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.");
            location.href = "settings.html"; // ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©
            return;
        }
        
        const data = await loadUserData(); // Ù…Ù† auth.js
        if (data) {
            currentUserData = data;
        }
        
        displayTotalCoins(); 
        setupGameRoles();
        playerDisplay.innerText = `Ø¯ÙˆØ±: ${players[i]}`; 
    });
}


// ----------------------------------
// 1. Ù…Ù†Ø·Ù‚ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²Ø§Øª ÙˆØ§Ù„Ù€ Pro
// ----------------------------------

function isPro() {
    const proExpiryTime = currentUserData.proExpiryTime || 0; 
    return proExpiryTime > new Date().getTime();
}

function getTotalCoins() {
    return currentUserData.totalCoins || 0;
}

function displayTotalCoins() {
    totalCoinsValue.innerText = getTotalCoins();
}

/**
 * @function calculateAndAddCoins
 * @description Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ÙƒÙˆÙŠÙ†Ø² Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø© (Ù…Ù† 5 Ø¥Ù„Ù‰ 15) ÙˆØ¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¹Ø¨Ø± Firestore.
 */
async function calculateAndAddCoins() {
    // âš ï¸ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù†Ø·Ø§Ù‚ Ø¥Ù„Ù‰ 5-15 ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª
    
    // Pro Bonus: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ProØŒ ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ ÙƒÙˆÙŠÙ†Ø²Ø§Øª Ø£ÙƒØ«Ø±
    const proMultiplier = isPro() ? 1.5 : 1; 
    
    // Ù†Ø·Ø§Ù‚ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²: 5-15 (Ø´Ø§Ù…Ù„Ø©)
    const minCoins = 5;
    const maxCoins = 15; 
    
    // ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨ÙŠÙ† 5 Ùˆ 15 
    const baseCoins = Math.floor(Math.random() * (maxCoins - minCoins + 1)) + minCoins; 
    
    const coinsEarned = Math.floor(baseCoins * proMultiplier);
    
    const currentCoins = getTotalCoins();
    const newTotalCoins = currentCoins + coinsEarned;
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase Firestore
    const saveSuccessful = await saveUserData(newTotalCoins, currentUserData.proExpiryTime || 0);
    
    if (saveSuccessful) {
        currentUserData.totalCoins = newTotalCoins; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        displayTotalCoins();
        
        // Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„ÙƒØ³Ø¨
        alert(`ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø±Ø¨Ø­Øª ${coinsEarned} ÙƒÙˆÙŠÙ†Ø²Ù‹Ø§ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø©. ${isPro() ? '(Ù…ÙƒØ§ÙØ£Ø© Pro Ù…Ø·Ø¨Ù‚Ø©!)' : ''} Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²Ø§Øª Ø§Ù„Ø¢Ù†: ${newTotalCoins}`);
    } else {
        console.error("ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²Ø§Øª.");
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.");
    }
    
    return coinsEarned;
}

// ----------------------------------
// 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± (Ù…ÙØµØ­Ù‘ÙØ­ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±)
// ----------------------------------

function setupGameRoles() {
    let defaultWords = ["ØªÙØ§Ø­", "Ø³ÙŠØ§Ø±Ø©", "Ù…Ø¯Ø±Ø³Ø©", "Ø¨Ø­Ø±", "Ù‡Ø§ØªÙ", "Ø·Ø§Ø¦Ø±Ø©", "Ø¬ÙˆØ§Ù„", "Ù…ÙƒØªØ¨Ø©", "Ø·Ø§ÙˆÙ„Ø©", "ÙƒØ±Ø³ÙŠ"]; 
    let proWords = ["ÙƒÙˆÙƒØ¨", "Ø¬Ø§Ø³ÙˆØ³", "Ø§Ù„Ù…Ø§Ø³", "Ù…Ø®ØªØ±Ø¹", "Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ©", "Ø´Ù„Ø§Ù„", "Ù…ØªØ§Ù‡Ø©"]; 
    let words = [];
    const isUserPro = isPro(); 

    // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª
    if (settings.source === "default") words = defaultWords;
    else if (settings.source === "custom" && Array.isArray(settings.customWords)) words = settings.customWords;
    else if (settings.source === "both" && Array.isArray(settings.customWords)) words = defaultWords.concat(settings.customWords);
    else words = defaultWords; 

    // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø§Øª Pro Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø´ØªØ±ÙƒØ§Ù‹
    if (isUserPro) {
        words = words.concat(proWords);
    }
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª Ø¨Ø´ÙƒÙ„ Ø§Ø®ØªÙŠØ§Ø±ÙŠ
    words = [...new Set(words)];

    if (words.length === 0) {
        alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.");
        location.href = "settings.html";
        return;
    }

    // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
    if (settings.multiWordMode === true && words.length >= 2) {
        let wordIndex1 = Math.floor(Math.random() * words.length);
        civilWord = words[wordIndex1];
        
        // ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø­ØªØ§Ù„ Ù…Ø®ØªÙ„ÙØ©
        let availableWords = words.filter((w, index) => index !== wordIndex1);
        let wordIndex2 = Math.floor(Math.random() * availableWords.length);
        impostorWord = availableWords[wordIndex2]; 
        
    } else {
        // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ (ÙƒÙ„Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹)
        civilWord = words[Math.floor(Math.random() * words.length)];
        impostorWord = civilWord; // Ø§Ù„Ù…Ø­ØªØ§Ù„ ÙŠØ±Ù‰ Ù†ÙØ³ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙˆØ¶Ø¹ (Ù„Ø§ ØªØ³ØªØ®Ø¯Ù…)
    }
    
    let totalPlayers = players.length;
    // Ù†Ø¨Ø¯Ø£ Ø¨ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙƒÙ€ null Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¯Ù‚ÙŠÙ‚ Ù„Ø§Ø­Ù‚Ø§Ù‹
    roles = Array(totalPlayers).fill(null); 
    
    // Ù…ØµÙÙˆÙØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    let indices = Array.from({length: totalPlayers}, (v, k) => k).sort(() => Math.random() - 0.5);
    
    
    // Ø¨. Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„ÙŠØ¯ÙˆÙŠØ© (Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù€ Pro)
    const hasManualRoles = isUserPro && (settings.manualImpostors && settings.manualImpostors.length > 0 || settings.manualNoWord && settings.manualNoWord.length > 0);

    if (hasManualRoles) {
        
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­ØªØ§Ù„ÙŠÙ† ÙŠØ¯ÙˆÙŠØ§Ù‹
        settings.manualImpostors.forEach(name => {
            const playerIndex = players.indexOf(name);
            if (playerIndex !== -1) {
                roles[playerIndex] = IMP; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù„Ø§Ù…Ø© Ø¯Ø§Ø®Ù„ÙŠØ©
            }
        });

        // ØªØ¹ÙŠÙŠÙ† "Ø¨Ù„Ø§ ÙƒÙ„Ù…Ø©" ÙŠØ¯ÙˆÙŠØ§Ù‹
        settings.manualNoWord.forEach(name => {
            const playerIndex = players.indexOf(name);
            if (playerIndex !== -1) {
                if (roles[playerIndex] !== IMP) { // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø­ØªØ§Ù„ ÙˆØ¨Ù„Ø§ ÙƒÙ„Ù…Ø©
                    roles[playerIndex] = NW; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù„Ø§Ù…Ø© Ø¯Ø§Ø®Ù„ÙŠØ©
                }
            }
        });
        
    } 
    // Ø£. ÙˆØ¶Ø¹ Ø§Ù„ÙÙˆØ¶Ù‰ (Pro Ùˆ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®ÙŠØ§Ø±)
    else if (settings.chaosMode === true && isUserPro && Math.random() < 0.20) {
        
        // ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙƒÙ€ IMP Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹
        roles = Array(totalPlayers).fill(IMP); 
        let numNoWordChaos = Math.floor(totalPlayers * 0.2); 
        
        for (let j = 0; j < numNoWordChaos && j < totalPlayers; j++) {
            roles[indices[j]] = NW; // ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø¨Ø¹Ø¶Ù‡Ù… ÙƒØ¨Ù„Ø§ ÙƒÙ„Ù…Ø©
        }
        
    } 
    // Ø¬. Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ - Ø§Ù„Ù…ÙØµØ­Ù‘ÙØ­)
    else {
        
        const numImpostors = settings.impostors || 1; 
        let numNoWord = settings.noWordRole === true && totalPlayers > numImpostors ? 1 : 0; 
        let currentImpostors = 0;
        let currentNoWord = 0;
        
        // Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ÙˆØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ØºÙŠØ± Ø§Ù„Ù…Ø¯Ù†ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
        for (let j = 0; j < totalPlayers; j++) {
            const index = indices[j];
            
            if (currentImpostors < numImpostors) {
                roles[index] = IMP;
                currentImpostors++;
            } else if (currentNoWord < numNoWord) {
                roles[index] = NW;
                currentNoWord++;
            } else {
                // Ø§Ù„Ø¨Ù‚ÙŠØ© ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡Ù… ÙƒÙ…Ø¯Ù†ÙŠÙŠÙ† Ù„Ø§Ø­Ù‚Ø§Ù‹
            }
        }
    }
    
    // âš ï¸ Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ØªØ¹ÙŠÙŠÙ† civilWord Ù„ÙƒÙ„ Ù…Ù† Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø¯ÙˆØ± Ù„Ù‡ (Ø§Ù„Ù…Ø¯Ù†ÙŠÙŠÙ†)
    for (let k = 0; k < totalPlayers; k++) {
        if (roles[k] === null) { // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¯ÙˆØ± Ù„Ø§ ÙŠØ²Ø§Ù„ null
            roles[k] = civilWord;
        }
    }
}


// ----------------------------------
// 3. Ø¯ÙˆØ§Ù„ ØªÙØ§Ø¹Ù„ÙŠØ© (Ù…ÙØµØ­Ù‘ÙØ­ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±)
// ----------------------------------

/**
 * @function show
 * @description ÙƒØ´Ù Ø§Ù„Ø¯ÙˆØ± ÙˆØ§Ù„ÙƒÙ„Ù…Ø© Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ. (Ù…ÙØµØ­Ù‘ÙØ­)
 */
function show() {
  card.classList.add("revealed");
  
  const roleMarker = roles[i];
  let displayWord = "";
  
  // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠ (ÙŠØ±Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠØ©)
  if (roleMarker === civilWord) {
      displayWord = `<span style="color: #34d399;">Ø¯ÙˆØ±Ùƒ: Ø§Ù„Ù…Ø¯Ù†ÙŠ</span>`;
      displayWord += `<div class="instruction-text" style="font-size: 1.5rem; color: #f1f5f9; margin-top: 10px;">Ø§Ù„ÙƒÙ„Ù…Ø©: ${civilWord}</div>`;
  } 
  // Ø­Ø§Ù„Ø© "Ø¨Ù„Ø§ ÙƒÙ„Ù…Ø©"
  else if (roleMarker === NW) {
      displayWord = `<span style="color: #6366f1;">Ù„Ø§ ÙƒÙ„Ù…Ø© Ù„Ùƒ!</span>`;
  }
  // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­ØªØ§Ù„
  else if (roleMarker === IMP) {
      if (settings.multiWordMode === true) {
           displayWord = `<span style="color: #ff4f4f;">Ø¯ÙˆØ±Ùƒ: Ø§Ù„Ù…Ø­ØªØ§Ù„ ğŸ˜ˆ</span>`;
           displayWord += `<div class="instruction-text" style="font-size: 1.5rem; color: #f1f5f9; margin-top: 10px;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø­ØªØ§Ù„: ${impostorWord}</div>`;
           displayWord += `<div class="instruction-text" style="font-size: 0.8rem; color: #ffcc00; margin-top: 5px;">*ØªØ°ÙƒÙ‘Ø±ØŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠ Ù‡ÙŠ ${civilWord}*</div>`;
      } else {
           displayWord = `<span style="color: #ff4f4f;">Ø£Ù†Øª Ø§Ù„Ù…Ø­ØªØ§Ù„ ğŸ˜ˆ</span>`; 
      }
  } 
  // Ø­Ø§Ù„Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© (Ù‚Ø¯ Ù„Ø§ ØªØ­Ø¯Ø« Ø¨Ø¹Ø¯ Ø§Ù„ØªØµØ­ÙŠØ­)
  else {
      displayWord = `<span style="color: #ffcc00;">Ø®Ø·Ø£: Ø¯ÙˆØ± ØºÙŠØ± Ù…Ø¹Ø±Ù!</span>`;
  }
  
  card.innerHTML = displayWord;
}


function hide() {
  card.classList.remove("revealed");
  card.innerHTML = `<span>Ø§Ø³Ø­Ø¨ Ø£Ùˆ Ø§Ø¶ØºØ· Ù…Ø¹ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±</span><div class="instruction-text">Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø¯ÙˆØ±Ùƒ</div>`;
}

function startTimer(duration) {
    if (duration <= 0) {
        timerContainer.style.display = 'none';
        return; 
    }
    
    timerContainer.style.display = 'block';
    nextBtn.style.display = 'none'; 
    
    let timeRemaining = duration;
    
    function updateTimerDisplay() {
        const minutes = String(Math.floor(timeRemaining / 60)).padStart(2, '0');
        const seconds = String(timeRemaining % 60).padStart(2, '0');
        timerContainer.innerText = `${minutes}:${seconds}`;

        if (timeRemaining <= 0) {
            clearInterval(timerInterval);
            timerContainer.innerText = "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!";
            timerContainer.style.color = '#ff4f4f'; 
            
            // ğŸ† Ù…Ù†Ø­ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²Ø§Øª Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª (Ù„Ù„Ø¬ÙˆÙ„Ø§Øª Ø°Ø§Øª Ø§Ù„Ù…Ø¤Ù‚Øª)
            gameCompleted = true; // Ù†Ø¤ÙƒØ¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø©
            calculateAndAddCoins(); 
            
            alert("Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø©! Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„ØªØµÙˆÙŠØª.");
        }
        timeRemaining--;
    }

    updateTimerDisplay(); 
    timerInterval = setInterval(updateTimerDisplay, 1000);
}


function next() {
  if(card.classList.contains("revealed")) {
      hide();
  }
  
  i++;
  
  if(i >= players.length){
    // Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    gameCompleted = true; // Ù†Ø¤ÙƒØ¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªÙˆØ²ÙŠØ¹ (Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ù‚Ø§Ø´)

    playerDisplay.innerText = "ØªÙ… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±! Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù†Ù‚Ø§Ø´.";
    card.style.display = 'none'; 
    nextBtn.style.display = 'none'; 
    
    endMessage.style.display = 'block';
    endMessage.innerText = "Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø© ğŸ—£ï¸";

    startTimer(settings.discussionTimer);

    // ğŸ† Ù…Ù†Ø­ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²Ø§Øª ÙÙˆØ±Ø§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø¤Ù‚Øª (Ø§Ù„Ù‚ÙŠÙ…Ø© 0)
    if (settings.discussionTimer === 0) {
        calculateAndAddCoins();
    }
    
    return;
  }
  
  playerDisplay.innerText = `Ø¯ÙˆØ±: ${players[i]}`;
}
</script>

</body>
</html>
