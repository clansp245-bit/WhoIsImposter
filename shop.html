here<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</title>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="auth.js"></script> 
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
/* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© */
body {
    font-family: 'Cairo', sans-serif;
    background-color: #0f172a;
    color: #f1f5f9;
    padding: 20px;
    min-height: 100vh;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
}

h2 {
    color: #ffcc00;
    margin-bottom: 30px;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø±Ø¶ */
.shop-item {
    background-color: #1e293b;
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 25px;
    width: 100%;
    max-width: 450px;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    text-align: center;
    border: 2px solid #ffcc00;
}

.shop-item h3 {
    color: #ffcc00;
    font-size: 1.8rem;
    margin-top: 0;
}

.shop-item p {
    color: #cbd5e1;
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: 20px;
}

.features-list {
    list-style: none;
    padding: 0;
    margin-bottom: 25px;
    text-align: right;
}

.features-list li {
    background-color: #334155;
    padding: 8px 15px;
    margin-bottom: 8px;
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
}

.features-list li i {
    color: #34d399;
    margin-left: 10px;
}

/* Ø²Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ */
.buy-btn {
    padding: 12px 30px;
    font-size: 1.1rem;
    font-weight: 700;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.2s;
    background-color: #34d399; 
    color: #0f172a;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
}

.buy-btn i {
    margin-left: 8px;
}

.buy-btn:hover {
    background-color: #10b981;
    transform: translateY(-1px);
}

.pro-status {
    margin-top: 20px;
    font-size: 1.1rem;
    font-weight: 700;
    color: #cbd5e1;
}

.pro-status.active {
    color: #34d399;
}

.pro-status.expired {
    color: #ff4f4f;
}

/* Ø´Ø§Ø´Ø© Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆÙŠÙ†Ø² ÙˆØ§Ù„Ø±Ø¬ÙˆØ¹ */
#coin-display {
    position: absolute;
    top: 20px;
    left: 20px;
    font-size: 1.2rem;
    font-weight: 700;
    color: #ffd700;
}

.home-link {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 24px;
    color: #94a3b8;
    cursor: pointer;
    transition: color 0.3s;
}
</style>
</head>

<body onload="loadShopData()">

<div id="coin-display">
    <i class="fas fa-coins"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total-coins-value">0</span>
</div>

<a href="index.html" class="home-link" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
    <i class="fas fa-home"></i>
</a>

<h2>ğŸ›’ Ù…ØªØ¬Ø± Ø§Ù„ÙƒÙˆÙŠÙ†Ø²</h2>

<div id="pro-membership-card" class="shop-item">
    <h3>Ø¹Ø¶ÙˆÙŠØ© Pro</h3>
    <p>Ø§ÙØªØ­ Ø¬Ù…ÙŠØ¹ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ…Ù‹Ø§!</p>

    <ul class="features-list">
        <li><i class="fas fa-check"></i> Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¬Ù…ÙŠØ¹ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª (Ø£Ø·Ø¹Ù…Ø©ØŒ Ø­ÙŠÙˆØ§Ù†Ø§ØªØŒ Ø£Ù…Ø§ÙƒÙ†ØŒ Ø§Ù„Ø®).</li>
        <li><i class="fas fa-check"></i> ØªÙØ¹ÙŠÙ„ Ø¯ÙˆØ± "Ø¨Ù„Ø§ ÙƒÙ„Ù…Ø©".</li>
        <li><i class="fas fa-check"></i> ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© (Ù„ÙƒÙ„ Ù…Ø­ØªØ§Ù„ ÙƒÙ„Ù…Ø© Ù…Ø®ØªÙ„ÙØ©).</li>
        <li><i class="fas fa-check"></i> Ù…Ø¶Ø§Ø¹Ù Ø§Ù„ÙƒÙˆÙŠÙ†Ø² (x1.5).</li>
    </ul>

    <div class="pro-status" id="proStatus">...</div>
    
    <button class="buy-btn" id="buyProBtn" onclick="buyProMembership()">
        Ø´Ø±Ø§Ø¡ Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ…Ø§Ù‹
        <i class="fas fa-coins"></i> <span id="proCost">300</span>
    </button>
</div>

<script>
// ************* Ø«ÙˆØ§Ø¨Øª Ø§Ù„Ù…ØªØ¬Ø± *************
const PRO_COST = 300; 
const PRO_DURATION_MS = 30 * 24 * 60 * 60 * 1000; // 30 ÙŠÙˆÙ…Ø§Ù‹ Ø¨Ø§Ù„Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©

const totalCoinsValue = document.getElementById("total-coins-value");
const proCostDisplay = document.getElementById("proCost");
const proStatusDisplay = document.getElementById("proStatus");
const buyProBtn = document.getElementById("buyProBtn");

// Ù…ØªØºÙŠØ± Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø© (ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ ÙÙŠ loadShopData)
let currentUserData = { totalCoins: 0, proExpiryTime: 0, players: [], settings: {} };
window.currentUserData = currentUserData; // Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡ ÙÙŠ auth.js

proCostDisplay.innerText = PRO_COST;

/**
 * @function loadShopData
 * @description ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Pro.
 */
async function loadShopData() {
    firebase.auth().onAuthStateChanged(async (user) => {
        if (!user) {
            alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
            window.location.href = "auth.html";
            return;
        }

        const data = await loadUserData(); 
        if (data) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ø¦Ù† Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ
            Object.assign(currentUserData, data);
            totalCoinsValue.innerText = currentUserData.totalCoins || 0;
        }
        
        checkProStatus();
    });
}

/**
 * @function checkProStatus
 * @description ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ø´ØªØ±Ø§Ùƒ Pro ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.
 */
function checkProStatus() {
    const isProActive = window.isPro(); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ù† auth.js
    const expiryTime = currentUserData.proExpiryTime || 0;
    const expiryDate = new Date(expiryTime);
    
    if (isProActive) {
        proStatusDisplay.className = 'pro-status active';
        proStatusDisplay.innerHTML = `âœ… Ù…ÙØ¹Ù„ Ø­ØªÙ‰: ${expiryDate.toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}`;
        buyProBtn.innerText = "ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ 30 ÙŠÙˆÙ…Ø§Ù‹";
        // ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙ…Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª
    } else {
        proStatusDisplay.className = 'pro-status expired';
        if (expiryTime > 0) {
             proStatusDisplay.innerHTML = `âŒ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© ÙÙŠ: ${expiryDate.toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' })}`;
        } else {
             proStatusDisplay.innerHTML = `âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ø¹Ø¯.`;
        }
        buyProBtn.innerText = "Ø´Ø±Ø§Ø¡ Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ…Ø§Ù‹";
    }
}

/**
 * @function buyProMembership
 * @description Ù…Ù†Ø·Ù‚ Ø´Ø±Ø§Ø¡ Ø¹Ø¶ÙˆÙŠØ© Pro Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙˆÙŠÙ†Ø².
 */
async function buyProMembership() {
    if (currentUserData.totalCoins < PRO_COST) {
        alert("âš ï¸ Ù„Ø§ ØªÙ…Ù„Ùƒ ÙƒÙˆÙŠÙ†Ø² ÙƒØ§ÙÙŠØ©! (Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: " + PRO_COST + " ÙƒÙˆÙŠÙ†Ø²)");
        return;
    }

    if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø´Ø±Ø§Ø¡ Ø¹Ø¶ÙˆÙŠØ© Pro Ù…Ù‚Ø§Ø¨Ù„ ${PRO_COST} ÙƒÙˆÙŠÙ†Ø²ØŸ`)) {
        return;
    }

    // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯
    const now = new Date().getTime();
    const currentExpiry = currentUserData.proExpiryTime || now;
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ø§ ÙŠØ²Ø§Ù„ Ø³Ø§Ø±ÙŠØ§Ù‹ØŒ Ù†Ø¨Ø¯Ø£ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯ Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠ
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù†ØªÙ‡ÙŠØ§Ù‹ Ø£Ùˆ Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯ØŒ Ù†Ø¨Ø¯Ø£ Ø§Ù„ØªÙ…Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¢Ù†
    const startTime = (currentExpiry > now) ? currentExpiry : now;
    const newProTime = startTime + PRO_DURATION_MS;

    const newCoins = currentUserData.totalCoins - PRO_COST;
    
    // 2. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Firebase
    const saveSuccessful = await saveUserData(
        newCoins, 
        newProTime,
        currentUserData.players || [], // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        currentUserData.settings || {} // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    );

    if (saveSuccessful) {
        // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        currentUserData.totalCoins = newCoins;
        currentUserData.proExpiryTime = newProTime;
        
        totalCoinsValue.innerText = newCoins;
        alert("ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¹Ø¶ÙˆÙŠØ© Pro Ø¨Ù†Ø¬Ø§Ø­.");
        checkProStatus(); 
    } else {
        alert("âŒ ÙØ´Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
    }
}
</script>

</body>
</html>
