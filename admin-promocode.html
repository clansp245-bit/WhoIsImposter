<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ› ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ - Admin</title>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="auth.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
body { font-family: 'Cairo', sans-serif; background-color: #0f172a; color: #f1f5f9; text-align: center; padding:20px; min-height:100vh; margin:0;}
h2 { font-size:2rem; font-weight:700; margin-bottom:25px; color:#ffd700;}
.card { background-color:#1e293b; padding:25px; border-radius:12px; max-width:500px; margin:20px auto; box-shadow:0 4px 6px rgba(0,0,0,0.1);}
label { display:block; margin:15px 0 5px 0; font-weight:700; color:#94a3b8;}
input, select { width:100%; padding:10px; border-radius:6px; border:1px solid #334155; background-color:#334155; color:#f1f5f9; margin-bottom:10px;}
button { padding:12px; border:none; border-radius:8px; font-weight:700; width:100%; cursor:pointer; background-color:#34d399; color:#fff; transition:0.3s;}
button:hover { background-color:#10b981;}
.promocode-list { max-height:300px; overflow-y:auto; margin-top:15px; }
.promocode-list div { display:flex; justify-content:space-between; align-items:center; padding:5px; border-bottom:1px solid #475569; }
.promocode-list div button { background-color:#ff4f4f; padding:4px 8px; font-size:12px; border-radius:4px; color:#fff; }
.error-message { color:#ff4f4f; margin:10px 0; }
</style>
</head>
<body onload="checkAdmin()">

<h2>ğŸ› ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ - Admin</h2>

<div class="card" id="admin-card" style="display:none;">
    <p class="error-message" id="error-msg" style="display:none;"></p>
    
    <label for="new-code">Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
    <input type="text" id="new-code" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯">

    <label for="new-code-type">Ù†ÙˆØ¹ Ø§Ù„ÙƒÙˆØ¯</label>
    <select id="new-code-type">
        <option value="coins">ÙƒÙˆÙŠÙ†Ø²</option>
        <option value="pro">Ø¹Ø¶ÙˆÙŠØ© Pro</option>
    </select>

    <label for="new-code-amount">Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙˆÙŠÙ†Ø² Ø£Ùˆ Ø£ÙŠØ§Ù… Pro</label>
    <input type="number" id="new-code-amount" placeholder="Ø§Ù„Ø¹Ø¯Ø¯">

    <button onclick="createPromocode()">Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯</button>

    <div class="promocode-list" id="promocode-list"></div>
</div>

<script>
const db = firebase.firestore();
const errorMsg = document.getElementById("error-msg");

async function checkAdmin(){
    firebase.auth().onAuthStateChanged(user=>{
        if(!user){ window.location.href="auth.html"; return;}
        if(user.email !== "clansp245@gmail.com"){ 
            errorMsg.innerText = "Ù„Ø§ ÙŠØ­Ù‚ Ù„Ùƒ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©!";
            errorMsg.style.display="block";
            return;
        }
        document.getElementById("admin-card").style.display="block";
        loadPromocodes();
    });
}

async function loadPromocodes(){
    const listDiv = document.getElementById("promocode-list");
    listDiv.innerHTML="";
    try{
        const snapshot = await db.collection("promocodes").get();
        snapshot.forEach(doc=>{
            const data = doc.data();
            const div = document.createElement("div");
            div.innerHTML = `${doc.id} (${data.type} - ${data.amount}) <button onclick="deletePromocode('${doc.id}')">Ø­Ø°Ù</button>`;
            listDiv.appendChild(div);
        });
    } catch(e){
        console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯:",e);
        errorMsg.innerText="Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯!";
        errorMsg.style.display="block";
    }
}

async function createPromocode(){
    const code = document.getElementById("new-code").value.trim();
    const type = document.getElementById("new-code-type").value;
    const amount = Number(document.getElementById("new-code-amount").value);

    if(!code || !type || !amount){ 
        errorMsg.innerText="Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.";
        errorMsg.style.display="block";
        return;
    }

    try{
        await db.collection("promocodes").doc(code).set({type, amount, redeemedBy:[]});
        document.getElementById("new-code").value="";
        document.getElementById("new-code-amount").value="";
        errorMsg.style.display="none";
        loadPromocodes();
        alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!");
    } catch(e){
        console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯:",e);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯!");
    }
}

async function deletePromocode(code){
    if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ØŸ")) return;
    try{
        await db.collection("promocodes").doc(code).delete();
        loadPromocodes();
    } catch(e){
        console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯:",e);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯!");
    }
}
</script>

</body>
</html>
