<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸŸï¸ Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="auth.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Cairo',sans-serif;
  background:#0f172a;
  color:#f1f5f9;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
  padding:20px;
}
.card{
  background:#1e293b;
  padding:20px;
  border-radius:12px;
  width:90%;
  max-width:500px;
  margin-bottom:20px;
}
h2{text-align:center;color:#34d399}
label{margin-top:12px;display:block}
input{
  width:100%;
  margin-top:6px;
  padding:10px;
  border-radius:8px;
  border:1px solid #334155;
  background:#334155;
  color:#fff;
}
button{
  margin-top:12px;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#6366f1;
  color:#fff;
  font-weight:700;
  cursor:pointer;
  width:100%;
}
button:hover{background:#4f46e5}
.msg{margin-top:10px;text-align:center;color:#ffd700;}
.code-card{
  background:#334155;
  padding:12px;
  border-radius:8px;
  margin-top:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
}
.code-info{flex:1; min-width:200px;}
.code-actions button{margin-left:6px; margin-top:6px; width:auto;padding:6px 10px;font-size:14px;}
.active{background:#22c55e;}
.inactive{background:#ef4444;}
</style>
</head>

<body>

<div class="card">
  <h2>ğŸŸï¸ Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯</h2>

  <label>Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ¯</label>
  <input id="codeName" placeholder="Ù…Ø«Ø§Ù„: FREE100">

  <label>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²</label>
  <input type="number" id="coins" value="50">

  <label>Ù…Ø¯Ø© Pro Ø¨Ø§Ù„Ø£ÙŠØ§Ù… (0 = Ø¨Ø¯ÙˆÙ†)</label>
  <input type="number" id="proDays" value="0">

  <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (0 = ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯)</label>
  <input type="number" id="maxUses" value="0">

  <button onclick="createCode()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯</button>

  <div id="msg" class="msg"></div>
</div>

<div class="card">
  <h2>ğŸ“œ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</h2>
  <div id="codesList"></div>
</div>

<script>
const db = firebase.firestore();
firebase.auth().onAuthStateChanged(user=>{
  if(!user){ location.href="auth.html"; }
  else{ loadCodes(); }
});

async function createCode(){
  const code = document.getElementById("codeName").value.trim().toUpperCase();
  const coins = Number(document.getElementById("coins").value);
  const proDays = Number(document.getElementById("proDays").value);
  const maxUsesInput = Number(document.getElementById("maxUses").value);
  const maxUses = maxUsesInput>0 ? maxUsesInput : 0;
  const msg = document.getElementById("msg");

  if(!code){ msg.textContent="âŒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ¯"; return; }

  if(!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ ${code}?`)) return;

  try{
    const ref = db.collection("promocodes").doc(code);
    const snap = await ref.get();
    if(snap.exists){ msg.textContent="âŒ Ø§Ù„ÙƒÙˆØ¯ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§"; return; }

    await ref.set({
      coins: coins,
      durationDays: proDays,
      maxUses: maxUses,
      redeemedBy: [],
      active:true,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    msg.textContent="âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­";
    document.getElementById("codeName").value="";
    document.getElementById("coins").value=50;
    document.getElementById("proDays").value=0;
    document.getElementById("maxUses").value=0;

    loadCodes();
  }catch(e){
    console.error(e);
    msg.textContent="âŒ Ø­Ø¯Ø« Ø®Ø·Ø£";
  }
}

async function loadCodes(){
  const list = document.getElementById("codesList");
  list.innerHTML="";

  const snapshot = await db.collection("promocodes").orderBy("createdAt","desc").get();
  snapshot.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement("div");
    div.className="code-card";

    const info = document.createElement("div");
    info.className="code-info";
    info.innerHTML=`
      <strong>${doc.id}</strong><br>
      ÙƒÙˆÙŠÙ†Ø²: ${data.coins} | Pro: ${data.durationDays} Ø£ÙŠØ§Ù… | Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: ${data.maxUses===0?'ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯':data.maxUses} | Ø§Ù„Ø­Ø§Ù„Ø©: ${data.active?'Ù…ÙØ¹Ù„':'Ù…ÙˆÙ‚Ù'}
    `;

    const actions = document.createElement("div");
    actions.className="code-actions";

    const toggleBtn = document.createElement("button");
    toggleBtn.textContent = data.active?'ØªØ¹Ø·ÙŠÙ„':'ØªÙØ¹ÙŠÙ„';
    toggleBtn.className = data.active?'inactive':'active';
    toggleBtn.onclick = async ()=>{
      await db.collection("promocodes").doc(doc.id).update({active: !data.active});
      loadCodes();
    }

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "Ø­Ø°Ù";
    deleteBtn.onclick = async ()=>{
      if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ ${doc.id}?`)){
        await db.collection("promocodes").doc(doc.id).delete();
        loadCodes();
      }
    }

    actions.appendChild(toggleBtn);
    actions.appendChild(deleteBtn);

    div.appendChild(info);
    div.appendChild(actions);
    list.appendChild(div);
  });
}
</script>

</body>
</html>
