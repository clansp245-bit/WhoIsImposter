<!DOCTYPE html>  
<html lang="ar" dir="rtl">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>ğŸ•µï¸ Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠ Ø§Ù„Ù…Ø­ØªØ§Ù„</title>  
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>  
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>  
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>  
    <script src="auth.js"></script>  
  
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">  

<style>  
    /* -------------------------------------------------- */  
    /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙˆØ§Ù„Ù‚Ø¯ÙŠÙ…Ø© */  
    /* -------------------------------------------------- */  
    body {  
        font-family: 'Cairo', sans-serif;  
        background-color: #0f172a;   
        color: #f1f5f9;   
        text-align: center;  
        padding: 20px;  
        min-height: 100vh;  
        margin: 0;  
        display: flex;  
        flex-direction: column;  
        align-items: center;  
        position: relative;   
    }  

    /* -------------------------------------------------- */  
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */  
    /* -------------------------------------------------- */  

    /* Ø§Ù„ØªØ§Ø¬ (Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±) */  
    #pro-plans-btn {  
        position: absolute;  
        top: 20px;  
        left: 20px;  
        font-size: 24px;  
        color: #ffd700;   
        cursor: pointer;  
        transition: color 0.3s;  
    }  

    /* Ø§Ù„ÙƒÙˆÙŠÙ†Ø² (Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†) */  
    #coin-display {  
        position: absolute;  
        top: 20px;  
        right: 20px;  
        font-size: 1.1rem;  
        font-weight: 700;  
        color: #94a3b8;  
    }  
      
    /* Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø±Ø§Ø¨Ø· Ù„ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„) */  
    #user-name-display {  
        font-size: 1.5rem;  
        font-weight: 700;  
        color: #34d399;   
        margin-top: 50px;   
        margin-bottom: 5px;  
        display: flex;  
        align-items: center;  
        justify-content: center;  
        text-decoration: none;  
        cursor: pointer;  
    }  
    #user-name-display:hover {  
        color: #10b981;  
    }  
    #user-name-display .pro-tag {  
        color: #ffd700;  
        margin-right: 8px;  
        font-size: 1.2em;  
    }  
      
    /* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ÙˆØ§Ù„Ø®Ø¨Ø±Ø© */  
    #level-xp-display {  
        color:#94a3b8;   
        font-size:0.9rem;   
        margin-bottom: 5px;  
        font-weight: 700;  
    }  

    /* -------------------------------------------------- */
    /* ØªÙ†Ø³ÙŠÙ‚ Ø´Ø±ÙŠØ· Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
    /* -------------------------------------------------- */
    #xp-bar-container {
        width: 90%;
        max-width: 450px;
        height: 12px;
        background-color: #334155; /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´Ø±ÙŠØ· */
        border-radius: 6px;
        margin: 10px auto 10px auto; /* ØªØ­Øª Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ */
        overflow: hidden;
    }
    #xp-bar {
        height: 100%;
        width: 0%; /* Ø³ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ØµÙØ± */
        background-color: #6366f1; /* Ù„ÙˆÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
        border-radius: 6px;
        transition: width 0.5s ease-in-out;
    }
    #xp-next-level-info {
        color: #94a3b8;
        font-size: 0.8rem;
        font-weight: 700;
        margin-bottom: 25px; /* ÙŠØ­Ù„ Ù…Ø­Ù„ Ø§Ù„Ù€ margin-bottom Ø§Ù„Ù‚Ø¯ÙŠÙ… */
    }
    /* -------------------------------------------------- */


    h1 {  
        font-size: 2.5rem;  
        font-weight: 700;  
        margin-top: 20px;  
        margin-bottom: 30px;  
        color: #f1f5f9;   
    }  

    .card {  
        background-color: #1e293b;   
        padding: 30px;  
        border-radius: 12px;  
        max-width: 450px;  
        width: 90%;  
        margin: 10px auto;  
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 10px 15px rgba(0, 0, 0, 0.2);  
        text-align: right;  
    }  

    #player-input {  
        font-family: 'Cairo', sans-serif;  
        width: calc(100% - 24px);   
        padding: 12px;  
        border-radius: 8px;  
        border: 1px solid #334155;  
        font-size: 16px;  
        background-color: #334155;   
        color: #f1f5f9;  
        margin-bottom: 10px;  
    }  

    #add-player-btn, #settings-btn-card {  
        padding: 10px 20px;  
        font-size: 16px;  
        font-weight: 700;  
        border: none;  
        border-radius: 8px;   
        cursor: pointer;  
        transition: background-color 0.3s;  
        width: 100%;  
        margin-top: 10px;  
    }  
    #add-player-btn {  
        background-color: #34d399;   
        color: #ffffff;  
    }  
    #add-player-btn:hover {  
        background-color: #10b981;   
    }  
    #settings-btn-card {   
        background-color: #6366f1;   
        color: #ffffff;  
        margin-bottom: 20px;   
    }  
    #settings-btn-card:hover {  
        background-color: #4f46e5;  
    }  

    #player-list {  
        list-style: none;  
        padding: 0;  
        margin-top: 20px;  
        max-height: 200px;  
        overflow-y: auto;  
    }  
    #player-list li {  
        display: flex;  
        justify-content: space-between;  
        align-items: center;  
        padding: 10px 15px;  
        margin-bottom: 8px;  
        background-color: #334155;  
        border-radius: 8px;  
        font-size: 1rem;  
    }  
      
    .delete-btn {  
        background: none;  
        border: none;  
        color: #ff4f4f;   
        cursor: pointer;  
        font-size: 1.1rem;  
        transition: color 0.3s;  
    }  

    #start-game-btn {   
        margin-top: 30px;   
        padding: 12px 30px;  
        font-size: 18px;  
        font-weight: 700;  
        border: none;  
        border-radius: 8px;   
        cursor: pointer;  
        transition: background-color 0.3s, transform 0.2s;  
        background-color: #6366f1;  
        color: #ffffff;  
        width: 100%;  
    }  
    #start-game-btn:hover:enabled {  
        background-color: #4f46e5;   
        transform: translateY(-2px);  
    }  
    #start-game-btn:disabled {  
        background-color: #475569;  
        cursor: not-allowed;  
    }  
      
    #sign-out-btn {  
        position: absolute;  
        bottom: 20px;  
        right: 20px;   
        background: none;  
        border: none;  
        color: #ff4f4f;  
        cursor: pointer;  
        font-size: 0.9rem;  
        transition: color 0.3s;  
    }  

    .alert-message {  
        color: #ffcc00;  
        margin-top: 15px;  
        font-size: 0.9rem;  
    }  

    /* -------------------- Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© -------------------- */
    #incoming-gifts-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        animation: fadeIn 0.5s;
    }

    #gifts-modal {
        background: #1e293b;
        padding: 30px;
        border-radius: 15px;
        max-width: 90%;
        width: 400px;
        text-align: center;
        box-shadow: 0 0 40px rgba(99, 102, 241, 0.7);
        transform: scale(0.8);
        animation: scaleIn 0.5s forwards;
    }

    #gifts-modal h2 {
        color: #ffd700;
        margin-bottom: 20px;
    }

    .gift-entry {
        background: #334155;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 700;
    }

    .gift-entry .sender {
        color: #34d399;
        font-size: 0.9rem;
    }

    #close-gifts-btn {
        margin-top: 20px;
        background: #6366f1;
        color: white;
        padding: 10px 20px;
        width: auto;
        cursor: pointer;
        border: none;
        border-radius: 8px;
        font-family: 'Cairo', sans-serif;
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes scaleIn { 
        to { transform: scale(1); } 
        0% { opacity: 0; }
        50% { opacity: 1; }
    }


</style>

</head>  
<body onload="checkAuthState()">  
<a href="plans.html" id="pro-plans-btn" title="Ø®Ø·Ø· Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© Ø§Ù„Ù…ØªÙ…ÙŠØ²Ø© (Pro)">  
    <i class="fas fa-crown"></i>  
</a>  
  
<div id="coin-display">  
    <i class="fas fa-coins"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total-coins-value">0</span>  
</div>  

<a href="profile.html" id="user-name-display">  
    Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...  
</a>  

<div id="level-xp-display">  
    Ø§Ù„Ù…Ø³ØªÙˆÙ‰ <span id="user-level">1</span> | Ø®Ø¨Ø±Ø© <span id="user-xp">0</span> XP  
</div>  

<div id="xp-bar-container">
    <div id="xp-bar"></div>
</div>
<div id="xp-next-level-info">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

<h1>Ø§Ø¨Ø¯Ø£ Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠ Ø§Ù„Ù…Ø­ØªØ§Ù„</h1>  

<div class="card">  
      
    <button id="settings-btn-card" onclick="location.href = 'settings.html'">  
        <i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª  
    </button>  
      
    <label for="player-input" style="font-weight: 700; color: #f1f5f9;">Ø£Ø¶Ù Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†:</label>  
      
    <input type="text" id="player-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨">  
    <button id="add-player-btn" onclick="addPlayer()">Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨</button>  

    <p style="color: #94a3b8; font-size: 0.9rem; margin-top: 15px;">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„Ø¯ÙŠÙƒ 3 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.</p>  
      
    <ul id="player-list">  
        </ul>  
      
    <div id="player-count-alert" class="alert-message" style="display: none;">  
        Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¹Ø¨ Ù‡Ùˆ 3 Ù„Ø§Ø¹Ø¨ÙŠÙ†.  
    </div>  

    <button id="start-game-btn" disabled onclick="saveAndStartGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© <i class="fas fa-play"></i></button>  

</div>  
  
<button id="sign-out-btn" onclick="signOutUser()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ <i class="fas fa-sign-out-alt"></i></button>

<div id="incoming-gifts-overlay">
    <div id="gifts-modal">
        <h2>ğŸ‰ Ù‡Ø¯Ø§ÙŠØ§ Ø¬Ø¯ÙŠØ¯Ø© ÙˆØµÙ„Øª Ø¥Ù„ÙŠÙƒ!</h2>
        <div id="new-gifts-list">
            </div>
        <button id="close-gifts-btn" onclick="clearNewGifts()">ØªÙ… Ø§Ù„ÙØªØ­</button>
    </div>
</div>

<script>  
    let players = [];   
    let currentUserData = {};   
    const playerList = document.getElementById("player-list");  
    const playerInput = document.getElementById("player-input");  
    const startGameBtn = document.getElementById("start-game-btn");   
    const playerCountAlert = document.getElementById("player-count-alert");  
    const userNameDisplay = document.getElementById("user-name-display");   
  
    // ----------------------------------  
    // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„ÙƒÙˆÙŠÙ†Ø²Ø§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§  
    // ----------------------------------  
      
    // ğŸš¨ Ø§ÙØªØ±Ø§Ø¶: isPro Ùˆ getRequiredXPForLevel Ùˆ loadUserData Ùˆ checkAndLevelUp Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ auth.js
    function isProUser(data) {  
        return isPro(data); 
    }  
  
    async function checkAuthState() {  
         firebase.auth().onAuthStateChanged(async (user) => {  
            if (user) {  
                // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                let data = await loadUserData();   
                if (data) {  
                    currentUserData = data;
                    
                    // ğŸš¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‚Ø¨Ù„ Ø£ÙŠ Ø´ÙŠØ¡ Ø¢Ø®Ø±
                    const newGifts = currentUserData.newGifts || [];
                    if (newGifts.length > 0) {
                        displayIncomingGifts(newGifts);
                    }
                    
                    // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
                    // ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« currentUserData Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹ ÙÙŠ checkAndLevelUp (Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹)
                    const leveledUp = await checkAndLevelUp(currentUserData);
                    
                    if (leveledUp) {
                         alert(`ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentUserData.level}!`);
                    }
                  
                    // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…
                    const nameToDisplay = currentUserData.displayName || user.email?.split('@')[0] || "Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯";
                    displayUserName(nameToDisplay); 
                  
                    // 4. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆÙŠÙ†Ø² ÙˆØ§Ù„Ù…Ø³ØªÙˆÙ‰ ÙˆØ§Ù„Ù€ XP ÙÙˆØ±Ø§Ù‹
                    displayTotalCoins();   
                    displayLevelAndXP();   
                    
                    // 5. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
                    await loadPlayers();   
                }  
            } else {  
                window.location.href = "auth.html";  
            }  
        });  
    }  
  
    function displayUserName(name) {  
        const isPro = isProUser(currentUserData);  
        const proTag = isPro   
            ? '<i class="fas fa-crown pro-tag" title="Ø¹Ø¶Ùˆ Ù…ØªÙ…ÙŠØ² (Pro)"></i>'  
            : '';  
              
        userNameDisplay.innerHTML = `${proTag} ${name}`;  
    }  
  
    function displayTotalCoins() {  
        document.getElementById("total-coins-value").innerText = currentUserData.totalCoins || 0;  
    }  
  
    // ----------------------------------
    // Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª ÙˆØ§Ù„Ø®Ø¨Ø±Ø© (ØªØ­Ø¯ÙŠØ«)
    // ----------------------------------

    function calculateLevelProgress(xp, level) {
        let xpGainedUpToPreviousLevel = 0;
        
        for (let i = 1; i < level; i++) {
            xpGainedUpToPreviousLevel += getRequiredXPForLevel(i); 
        }
        
        const xpRequiredForCurrentLevel = getRequiredXPForLevel(level);
        const xpProgress = xp - xpGainedUpToPreviousLevel;
        const percentage = (xpProgress / xpRequiredForCurrentLevel) * 100;

        return {
            xpProgress: xpProgress,
            xpNeeded: xpRequiredForCurrentLevel,
            percentage: Math.min(percentage, 100) 
        };
    }
  
    function displayLevelAndXP() {  
        const level = currentUserData.level || 1;  
        const xp = currentUserData.xp || 0;
        
        const progress = calculateLevelProgress(xp, level);
          
        document.getElementById("user-level").innerText = level;  
        document.getElementById("user-xp").innerText = xp;
        
        const xpBar = document.getElementById("xp-bar");
        xpBar.style.width = `${progress.percentage}%`;

        const xpNextLevelInfo = document.getElementById("xp-next-level-info");
        const xpRemaining = progress.xpNeeded - progress.xpProgress;
        
        if (progress.percentage >= 100) {
            xpNextLevelInfo.innerHTML = `ğŸŒŸ **Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${level} Ù…ÙƒØªÙ…Ù„!** Ù„Ø¯ÙŠÙƒ Ù…ÙƒØ§ÙØ£Ø© ØªÙ†ØªØ¸Ø±Ùƒ.`;
        } else {
            xpNextLevelInfo.innerHTML = `Ù…ØªØ¨Ù‚ÙŠ: **${xpRemaining}** XP Ù„Ù„Ù…Ø³ØªÙˆÙ‰ ${level + 1}`;
        }
    }
      
    // ----------------------------------  
    // Ù…Ù†Ø·Ù‚ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© (Ø§Ù„Ø¬Ø¯ÙŠØ¯)  
    // ---------------------------------- 

    function displayIncomingGifts(gifts) {
        const overlay = document.getElementById("incoming-gifts-overlay");
        const giftsList = document.getElementById("new-gifts-list");
        giftsList.innerHTML = '';
        
        gifts.forEach(g => {
            const div = document.createElement('div');
            div.className = 'gift-entry';
            div.innerHTML = `
                <span>${g.icon} ${g.giftName} (x${g.count})</span>
                <span class="sender">Ù…Ù†: ${g.senderName}</span>
            `;
            giftsList.appendChild(div);
        });

        overlay.style.display = 'flex';
    }

    async function clearNewGifts() {
        const overlay = document.getElementById("incoming-gifts-overlay");
        overlay.style.display = 'none';

        const user = firebase.auth().currentUser;
        if (!user) return;

        // Ø­Ø°Ù Ø­Ù‚Ù„ newGifts Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        try {
            const userRef = firebase.firestore().collection("users").doc(user.uid);
            await userRef.update({
                newGifts: firebase.firestore.FieldValue.delete()
            });
            currentUserData.newGifts = []; // ØªØ­Ø¯ÙŠØ« Ù…Ø­Ù„ÙŠØ§Ù‹
        } catch (error) {
            console.error("Error clearing newGifts:", error);
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§.");
        }
    }
    
    // ----------------------------------  
    // Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (ÙŠØ³ØªØ®Ø¯Ù… Firestore)  
    // ----------------------------------  
      
    function renderPlayers() {  
        playerList.innerHTML = '';  
        players.forEach((player, index) => {  
            const li = document.createElement('li');  
            li.innerHTML = `  
                <span>${player}</span>  
                <button class="delete-btn" onclick="removePlayer(${index})"><i class="fas fa-trash"></i></button>  
            `;  
            playerList.appendChild(li);  
        });  
          
        if (players.length >= 3) {  
            startGameBtn.disabled = false;  
            playerCountAlert.style.display = 'none';  
        } else {  
            startGameBtn.disabled = true;  
            playerCountAlert.style.display = 'block';  
        }  
    }  
  
    // ğŸš¨ Ø§ÙØªØ±Ø§Ø¶ Ø£Ù† saveUserData ØªØ£Ø®Ø° Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙˆØªØ­ÙØ¸Ù‡Ø§
    async function savePlayersToFirestore() {  
        const user = firebase.auth().currentUser;  
        if (!user) return;   
          
        // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ players ÙÙ‚Ø·
        await firebase.firestore().collection("users").doc(user.uid).set({
            players: players
        }, {merge: true}); 

        currentUserData.players = players;
    }  
  
    async function addPlayer() {  
        const playerName = playerInput.value.trim();  
        if (playerName && playerName.length > 0 && !players.includes(playerName)) {  
            players.push(playerName);  
            playerInput.value = '';  
            renderPlayers();  
            await savePlayersToFirestore();   
        } else if (players.includes(playerName)) {  
            alert("Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„!");  
        } else if (playerName.length === 0) {  
             alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨.");  
        }  
    }  
      
    async function removePlayer(index) {  
        players.splice(index, 1);  
        renderPlayers();  
        await savePlayersToFirestore();   
    }  
      
    async function loadPlayers() {  
        const savedPlayers = currentUserData.players;  
        if (Array.isArray(savedPlayers)) {  
            players = savedPlayers;  
        } else {  
            players = [];  
        }  
        renderPlayers();  
    }  
      
    async function saveAndStartGame() {  
        if (players.length < 3) {  
            alert("ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© 3 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©.");  
            return;  
        }  
          
        await savePlayersToFirestore();   
          
        localStorage.setItem("players", JSON.stringify(players));   
          
        location.href = "game.html";   
    }  
  
    playerInput.addEventListener('keypress', (event) => {  
        if (event.key === 'Enter') {  
            event.preventDefault();  
            addPlayer();  
        }  
    });  
      
    function signOutUser() {  
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) {  
            firebase.auth().signOut().then(() => {  
                localStorage.clear();  
                window.location.href = "auth.html";  
            }).catch((error) => {  
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬: " + error.message);  
            });  
        }  
    }  
  
</script>  
</body>  
</html>

